---
knit: "bookdown::render_book"
title: "The Epidemiologist R Handbook"  
description: "The Epi R Handbook is a R reference manual for applied epidemiology and public health."
author: "the handbook team"
date: "`r Sys.Date()`"
#url: 'https://github.com/nsbatra/Epi_R_handbook'
#twitter-handle: 
#cover-image: images/R_Handbook_Logo.png
site: bookdown::bookdown_site
# output: bookdown::gitbook:
#      config:
#           sharing:
#                twitter: yes
#                facebook: yes
#                whatsapp: yes
#                github: yes
documentclass: book
---

# output: bookdown::gitbook:

Placeholder


## R for applied epidemiology and public health {-}  
## How to use this handbook {-} 
## Acknowledgements {-}  
### Contributors {-}  
### Funding and support {-}  
### Inspiration {-}  
## Terms of Use and Contribution {-}  
### License {.unnumbered} 
### Citation {.unnumbered}
### Contribution {.unnumbered}  

<!--chapter:end:index.Rmd-->

# (PART) About this book {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_about_book.Rmd-->


# Editorial and technical notes { }

Placeholder


## Approach and style
### R packages {.unnumbered}
### Code style {.unnumbered}
### Nomenclature {.unnumbered}  
### Notes {.unnumbered} 
## Editorial decisions  
## Major revisions  
## Session info (R, RStudio, packages)  

<!--chapter:end:new_pages/editorial_style.Rmd-->


# Download handbook and data  

Placeholder


## Download offline handbook  
### Use download link {.unnumbered}  
### Use our R package {.unnumbered}  
## Download data to follow along  
### Use our R package {.unnumbered}  
### Download one-by-one {.unnumbered}  
#### Case linelist {.unnumbered}
#### Malaria count data {#data_malaria .unnumbered}  
#### Likert-scale data {.unnumbered}  
#### Flexdashboard {.unnumbered}  
#### Contact Tracing {.unnumbered} 
#### GIS {.unnumbered}  
#### Phylogenetic trees {.unnumbered}  
#### Standardization {.unnumbered}  
#### Time series and outbreak detection {#data_outbreak .unnumbered}  
#### Survey analysis {#data_survey .unnumbered}  
#### Shiny {#data_shiny .unnumbered}  

<!--chapter:end:new_pages/data_used.Rmd-->

# (PART) Basics {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_basics.Rmd-->

---
output:
  html_document: default
  word_document: default
  pdf_document: default
---

# Misingi ya R

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "basics_header_close.png"))
```

Karibu!

Ukurasa huu unakagua mambo muhimu ya R. Haikusudiwi kuwa mafunzo ya kina, lakini inatoa misingi na inaweza kuwa muhimu kwa kuburudisha kumbukumbu yako. Sehemu ya Nyenzo kwa ajili ya kujifunza inaunganisha kwa mafunzo ya kina zaidi.

PSehemu za ukurasa huu zimerekebishwa kwa ruhusa kutoka kwa mradi wa [R4Epis project](https://r4epis.netlify.app/).

Tazama ukurasa wa Badilisha hadi R kwa vidokezo vya kubadilisha hadi R kutoka STATA, SAS, au Excel.

```{r, echo=F}
# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))
pacman::p_load(apyramid)
```

<!-- ======================================================= -->

## Kwanini Utumie R?

Kama ilivyoelezwa kwenye tovuti ya mradi wa R, R ni lugha ya programu na mazingira ya kompyuta ya takwimu na michoro. Inatumika sana, inaweza kupanuliwa, na inaendeshwa na jamii.

**Gharama**

R ni bure kutumia! Kuna maadili dhabiti katika jamii ya nyenzo huria na huria.

**Uzalishaji**

Kufanya usimamizi na uchanganuzi wako wa data kupitia lugha ya programu (ikilinganishwa na Excel au zana nyingine ya kubofya-aina/kujitolea) huboresha uzalishaji tena, hurahisisha ugunduzi wa makosa, na kurahisisha mzigo wako wa kazi.

**Jumuiya**

Jumuiya ya R ya watumiaji ni kubwa na inashirikiana. Vifurushi vipya na zana za kushughulikia matatizo ya maisha halisi hutengenezwa kila siku, na kukaguliwa na jumuiya ya watumiaji. Kwa mfano, [R-Ladies](https://rladies.org/) ni shirika la ulimwenguni pote ambalo dhamira yake ni kukuza tofauti za kijinsia katika jumuiya ya R, na ni mojawapo ya mashirika makubwa ya watumiaji wa R. Inawezekana ina sura karibu nawe!

## Masharti muhimu

**RStudio** - RStudio ni Kiolesura cha Mchoro cha Mtumiaji (GUI) kwa matumizi rahisi ya R. Soma zaidi katika [sehemu ya RStudio](#rstudio).

**Vitu -** Kila kitu unachohifadhi katika R - hifadhidata, vigeu, orodha ya majina ya vijiji, jumla ya idadi ya watu, hata matokeo kama vile grafu - ni vitu ambavyo vimepewa jina na vinaweza kurejelewa katika amri za baadaye. Soma zaidi katika [sehemu ya Vitu](#objects)

**Kazi za kukokotoa** - Chaguo za kukokotoa ni operesheni ya msimbo ambayo inakubali ingizo na kurejesha pato lililobadilishwa. Soma zaidi katika [sehemu ya Kazi](#functions).

**Vifurushi** - Kifurushi cha R ni kifurushi cha vipengele vinavyoweza kushirikiwa. Soma zaidi katika[sehemu ya Vifurushi](#packages).

**Hati** - Hati ni faili ya hati inayoshikilia amri zako. Soma zaidikatika [sehemu ya Hati](#scripts)

## Rasilimali za kujifunza {#learning}

### Rasimilali ya RStudio {.unnumbered}

**Nyaraka za Usaidizi**

Tafuta kichupo cha"Msaada" cha RStudio kwa nyaraka kwenye vifurushi vya R na vipengele maalum. Hii ni ndani ya kidirisha ambacho pia kina Faili, Viwanja, na Vifurushi (kawaida kwenye kidirisha cha chini kulia). Kama njia ya mkato, unaweza pia kuandika jina la kifurushi au chaguo la kukokotoa kwenye dashibodi ya R baada ya alama ya kuuliza ili kufungua ukurasa wa Usaidizi husika. Usijumuishe mabano.

Kwa mfano: `?filter` or `?diagrammeR`.

**Mafunzo maingiliano**

Kuna njia kadhaa za kujifunza R kwa maingiliano ndani ya RStudio.

RStudio yenyewe inatoa kidirisha cha Mafunzo ambacho kinatumia kifurushi cha learnr. Sakinisha kifurushi hiki na ufungue mafunzo kupitia kichupo kipya cha "Mafunzo" kwenye kidirisha cha juu kulia cha RStudio (ambacho pia kina vichupo vya Mazingira na Historia).

Kifurushi cha [**swirl**](https://swirlstats.com/) kinatoa kozi shirikishi katika R Console. Sakinisha na upakie kifurushi hiki, kisha endesha amri `swirl()` (mabano tupu) kwenye koni ya R. Utaona vidokezo kutokea kwenye Dashibodi. Jibu kwa kuandika kwenye Dashibodi. Itakuongoza kupitia kozi ya chaguo lako.

### Cheatsheets {.unnumbered}

**Kuna "cheatsheets" nyingi za PDF zinazopatikana kwenye** [Tovuti ya RStudio](https://rstudio.com/resources/cheatsheets/), kwa mfano:

-   Mambo na kifurushi cha **forcats**\

-   Tarehe na nyakatu na kifurushi cha **lubridate**\

-   Minyororo na kifurushi cha **stringr**\

-   shughuli za mara kwa mara na kifurushi cha **purrr**\

-   Kuingiza data\

-   "Cheatsheet" ya Kubadilisha data kifurushi cha **dplyr**\

-   R Markdown (kuunda hati kama vile PDF, Word, Powerpoint...)

-   Shiny (kuunda programu wasilianifu za wavuti)\

-   Taswira ya data ukitumia kifurushi cha **ggplot2**

-   Upigaji ramani (GIS)\

-   kifurushi **leaflet** (ramani shirikishi)\

-   Python na R (kifurushi **reticulate** )

Hii ni rasilimali ya mtandaoni ya R mahususi kwa[watumiaji wa Excel](https://jules32.github.io/r-for-excel-users/)

### Twitter {.unnumbered}

R ina jumuia mahiri ya twitter ambapo unaweza kujifunza vidokezo, njia za mkato na habari - fuata akaunti hizi:

-   Tufuate! [\@epiRhandbook](https://twitter.com/epirhandbook)\
-   R Kazi moja Kwa Siku [\@rfuntionaday](https://twitter.com/rfunctionaday) ni rarilimali ya ajabu\
-   R ya Sayansi ya Data [\@rstats4ds](https://twitter.com/rstats4ds?lang=en)\
-   RStudio [\@RStudio](https://twitter.com/rstudio?lang=en)\
-   Vidokezo vya RStudio [\@rstudiotips](https://twitter.com/rstudiotips)\
-   Wanablogu wa R [\@Rbloggers](https://twitter.com/Rbloggers)\
-   Wanawake wa R [\@RLadiesGlobal](https://twitter.com/RLadiesGlobal)\
-   Hadley Wickham [\@hadleywickham](https://twitter.com/hadleywickham?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor)

Pia:

**#epitwitter** and **#rstats**

### Rasilimali za mtandaoni za bure {.unnumbered}

Maandishi ya uhakika ni kitabu cha[R for Data Science](https://r4ds.had.co.nz/) cha Garrett Grolemund and Hadley Wickham

Tovuti ya mradi wa [R4Epis](https://r4epis.netlify.app/) inalenga "kutayarisha zana sanifu za kusafisha data, uchanganuzi na kuripoti ili kushughulikia aina za kawaida za milipuko na tafiti zinazozingatia idadi ya watu ambazo zingefanywa katika mpangilio wa majibu ya dharura ya MSF." Unaweza kupata nyenzo za mafunzo ya misingi ya R, violezo vya ripoti za RMarkdown kuhusu milipuko na tafiti, na mafunzo ya kukusaidia kuziweka.

### **Lugha zingine isipokuwa Kiingereza** {.unnumbered}

[Nyenzo za Rstudio kwa Kihispania](https://www.rstudio.com/collections/espanol/)

[Utangulizi wa R na tidyverse (Kifaransa)](https://juba.github.io/tidyverse/index.html)

<!-- ======================================================= -->

## Ufungaji

### R na RStudio {.unnumbered}

**Jinsi ya kufunga R**

Tembelea tovuti hii <https://www.r-project.org/> na upakue toleo jipya zaidi la R linalofaa kwa kompyuta yako.

**Jinsi ya kufunga RStudio**

Tembelea tovuti hii <https://rstudio.com/products/rstudio/download/> na upakue toleo jipya zaidi lisilolipishwa la Eneo-kazi la RStudio linalofaa kwa kompyuta yako.

**Ruhusa**\
Kumbuka kwamba unapaswa kusakinisha R na RStudio kwenye kiendeshi ambacho umesoma na kuandika ruhusa. Vinginevyo, uwezo wako wa kusakinisha vifurushi vya R (tukio la mara kwa mara) utaathiriwa. Ukikumbana na matatizo, jaribu kufungua RStudio kwa kubofya aikoni kulia na kuchagua "Endesha kama msimamizi". Vidokezo vingine vinaweza kupatikana katika ukurasa wa R kwenye anatoa za mtandao.

**Jinsi ya kusasisha R na RStudio**

Toleo lako la R huchapishwa kwenye R Console wakati wa kuanza. Unaweza pia kuendesha sessionInfo().

Ili kusasisha R, nenda kwenye tovuti iliyotajwa hapo juu na usakinishe upya R. Vinginevyo, unaweza kutumia kisakinishi kifurushi (kwenye Windows) kwa kuendesha kisakinishi::updateR(). Hii itafungua visanduku vya mazungumzo ili kukusaidia kupakua toleo jipya zaidi la R na kusasisha vifurushi vyako hadi toleo jipya la R. Maelezo zaidi yanaweza kupatikana katika hati za kisakinishi.

Fahamu kuwa toleo la zamani la R bado litakuwepo kwenye kompyuta yako. Unaweza kuendesha kwa muda toleo la zamani ("usakinishaji" wa zamani) wa R kwa kubofya "Tools" -> "Global Options" katika RStudio na kuchagua toleo la R. Hii inaweza kuwa muhimu ikiwa unataka kutumia kifurushi ambacho hakijasasishwa kufanya kazi kwenye toleo jipya zaidi la R. Maelezo zaidi yanaweza kupatikana hati za **installr**

Ili kusasisha RStudio, unaweza kwenda kwenye tovuti iliyo hapo juu na upakue upya RStudio. Chaguo jingine ni kubofya "Help" -> "Check for Updates" kwenye RStudio, lakini hii inaweza isionyeshe masasisho ya hivi punde zaidi.

Ili kuona ni matoleo yapi ya R, RStudio, au vifurushi vilivyotumika wakati Kitabu hiki cha Mwongozo kilipotengenezwa, angalia ukurasa kwenye Maelezo ya Uhariri na kiufundi.

### Programu nyingine unaweza kuhitaji kusakinisha {.unnumbered}

-   TinyTeX (ya kuunda hati ya RMarkdown kwa PDF)

-   Pandoc (ya kuunda hati za RMarkdown)

-   RTools (za ujenzi wa vifurushi vya R)

-   phantomjs (kwa kuhifadhi picha tuli za mitandao ya uhuishaji, kama vile minyororo ya upokezaji)

#### TinyTex {.unnumbered}

-   TinyTex ni usambazaji maalum wa LaTeX, muhimu wakati wa kujaribu kutoa PDF kutoka kwa R\
    Tazama <https://yihui.org/tinytex/> kwa taarifa zaidi.

    Ili kusakinisha TinyTex kutoka R:

```{r, eval=F}
install.packages('tinytex')
tinytex::install_tinytex()
# to uninstall TinyTeX, run tinytex::uninstall_tinytex()
```

#### Pandoc {.unnumbered}

Pandoc ni kigeuzi cha hati, programu tofauti kutoka kwa R. Inakuja kuunganishwa na RStudio na haipaswi kuhitaji kupakuliwa. Husaidia mchakato wa kubadilisha hati za Rmarkdown hadi umbizo kama vile .pdf na kuongeza utendakazi changamano.RTools.

#### RTools {.unnumbered}

RTools ni mkusanyiko wa programu ya ujenzi wa vifurushi vya R

Sanikisha kutoka kwa tovuti hii: <https://cran.r-project.org/bin/windows/Rtools/>

#### phantomjs {.unnumbered}

Hii mara nyingi hutumiwa kupiga "picha za skrini" za kurasa za wavuti. Kwa mfano unapotengeneza msururu wa upokezaji na kifurushi cha epicontacts, faili ya HTML inatolewa ambayo inaingiliana na inayobadilika. Ikiwa unataka taswira tuli, inaweza kuwa muhimu kutumia kifurushi cha picha ya wavuti kugeuza mchakato huu kiotomatiki. Hii itahitaji programu ya nje "phantomjs". Unaweza kusakinisha phantomjs kupitia kifurushi cha webshot kwa amri `webshot::install_phantomjs()`.

<!-- ======================================================= -->

## RStudio {#rstudio}

### **Mwelekeo wa RStudio** {.unnumbered}

Kwanza, fungua RStudio. Kwa kuwa ikoni zao zinaweza kuonekana sawa, hakikisha unafungua RStudio na sio R.

Ili RStudio ifanye kazi lazima pia uwe na R iliyosakinishwa kwenye kompyuta (tazama hapo juu kwa maagizo ya usakinishaji).

RStudio ni kiolesura (GUI) kwa matumizi rahisi ya R. Unaweza kufikiria R kama injini ya gari, kufanya kazi muhimu, na RStudio kama mwili wa gari (pamoja na viti, vifuasi, n.k.) ambayo husaidia. kweli unatumia injini kusonga mbele! Unaweza kuona cheatsheet kamili ya kiolesura cha mtumiaji ya RStudio (PDF)[hapa](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf)

Kwa chaguo-msingi RStudio huonyesha paneli nne za mstatili

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "RStudio_overview.png"))
```

[***KIDOKEZO:***]{style="color: black;"}Ikiwa RStudio yako inaonyesha kidirisha kimoja tu cha kushoto ni kwa sababu bado huna hati zilizofunguliwa[.]{style="color: black;"}

**Kidirisha Chanzo**\
Kidirisha hiki, kwa chaguo-msingi katika sehemu ya juu kushoto, ni nafasi ya kuhariri, kuendesha, na kuhifadhi hati zako. Hati zina amri unazotaka kutekeleza. Kidirisha hiki kinaweza pia kuonyesha seti za data (fremu za data) za kutazamwa.

Kwa watumiaji wa Stata, kidirisha hiki ni sawa na madirisha yako ya Faili-Faili na Kihariri cha Data..

**Kidirisha cha R Console**

R Console, kwa chaguo-msingi kidirisha cha kushoto au cha chini kushoto katika R Studio, ndiyo nyumba ya "injini" ya R. Hapa ndipo amri zinaendeshwa na matokeo yasiyo ya picha na ujumbe wa hitilafu/onyo huonekana. Unaweza kuingiza na kuendesha amri moja kwa moja kwenye R Console, lakini tambua kuwa amri hizi hazijahifadhiwa jinsi zinavyofanya wakati wa kutekeleza amri kutoka kwa hati.

Ikiwa unaifahamu Stata, R Console ni kama Dirisha la Amri na pia Dirisha la Matokeo..

**Kidirisha cha Mazingira**\
Kidirisha hiki, kwa chaguo-msingi katika sehemu ya juu-kulia, mara nyingi hutumika kuona muhtasari mfupi wa vitu katika Mazingira ya R katika kipindi cha sasa. Vipengee hivi vinaweza kujumuisha seti za data zilizoingizwa, zilizorekebishwa au kuundwa, vigezo ulivyofafanua (k.m. wiki maalum ya uchanganuzi), au vekta au orodha ambazo umefafanua wakati wa uchanganuzi (k.m. majina ya maeneo). Unaweza kubofya kishale karibu na jina la fremu ya data ili kuona vigeu vyake.

Katika Stata, hii inafanana zaidi na dirisha la Kidhibiti cha Vigezo.

Kidirisha hiki pia kina Historia ambapo unaweza kuona amri ambazo unaweza hapo awali. Pia ina kichupo cha "Mafunzo" ambapo unaweza kukamilisha mafunzo shirikishi ya R ikiwa umesakinisha kifurushi cha mwanafunzi. Pia ina kidirisha cha "Viunganisho" kwa miunganisho ya nje, na inaweza kuwa na kidirisha cha "Git" ukichagua kusano na Github..

**Viwanja, Kitazamaji, Vifurushi na Kidirisha cha Usaidizi**\
Kidirisha cha chini kulia kinajumuisha tabo kadhaa muhimu. Michoro ya kawaida ya mpangilio ikijumuisha ramani itaonyeshwa kwenye kidirisha cha Njama. Matokeo shirikishi au HTML yataonyeshwa kwenye kidirisha cha Kitazamaji. Kidirisha cha Usaidizi kinaweza kuonyesha hati na faili za usaidizi. Kidirisha cha Faili ni kivinjari ambacho kinaweza kutumika kufungua au kufuta faili. Kidirisha cha Vifurushi hukuruhusu kuona, kusakinisha, kusasisha, kufuta, kupakia/kupakua vifurushi vya R, na kuona ni toleo gani la kifurushi ulicho nacho. Ili kujifunza zaidi kuhusu vifurushi tazama sehemu ya vifurushi hapa chini.

Kidirisha hiki kina usawa wa Stata wa madirisha ya Kidhibiti cha Viwanja na Kidhibiti cha Mradi.

### Mipangilio ya RStudio {.unnumbered}

Badilisha mipangilio na mwonekano wa RStudio kwenye menyu kunjuzi ya Zana, kwa kuchagua *Global Options*. Huko unaweza kubadilisha mipangilio chaguomsingi, ikijumuisha mwonekano/rangi ya usuli..

```{r out.width = c('50%'), fig.show='hold', echo=F}
knitr::include_graphics(here::here("images", "RStudio_tools_options_1.png"))

knitr::include_graphics(here::here("images", "RStudio_tools_options.png"))
```

**Anzisha tena**

Ikiwa R yako itaganda, unaweza kuanzisha upya R kwa kwenda kwenye menyu ya Kipindi na kubofya "Anzisha upya R". Hii inaepuka shida ya kufunga na kufungua RStudio. Kila kitu katika mazingira yako ya R kitaondolewa ukifanya hivi.

### Keyboard shortcuts {.unnumbered}

Baadhi ya njia za mkato za kibodi muhimu sana ziko hapa chini. Tazama mikato yote ya kibodi ya Windows, Max, na Linux katika ukurasa wa pili wa [kiolesura hiki cha RStudio](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf).

+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Windows/Linux                    | Mac                    | Kitendo                                                                                                                         |
+==================================+========================+=================================================================================================================================+
| Esc                              | Esc                    | Katisha amri ya sasa (inafaa ikiwa kwa bahati mbaya uliendesha amri isiyokamilika na huwezi kuepuka kuona "+" kwenye koni ya R) |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl+s                           | Cmd+s                  | Hifadhi(hati)                                                                                                                   |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Tab                              | Tab                    | Kamilisha kiotomatiki                                                                                                           |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Enter                     | Cmd + Enter            | Endesha laini za sasa/uteuzi wa msimbo                                                                                          |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Shift + C                 | Cmd + Shift + c        | toa maoni/toa maoni kwa mistari iliyoangaziwa                                                                                   |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Alt + -                          | Option + -             | Weka`<-`                                                                                                                        |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Shift + m                 | Cmd + Shift + m        | Weka `%>%`                                                                                                                      |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + l                         | Cmd + l                | Futa koni ya R                                                                                                                  |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Alt + b                   | Cmd + Option + b       | Endesha kutoka mwanzo hadi mstari wa sasa                                                                                       |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Alt + t                   | Cmd + Option + t       | Endesha sehemu ya msimbo wa sasa (R Markdown)                                                                                   |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Alt + i                   | Cmd + Shift + r        | Ingiza sehemu ya msimbo (kwenye R Markdown)                                                                                     |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Alt + c                   | Cmd + Option + c       | Tekeleza sehemu ya msimbo wa sasa (R Markdown)                                                                                  |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| up/down arrows in R console      | Same                   | Geuza kupitia amri zinazoendeshwa hivi karibuni                                                                                 |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Shift + up/down arrows in script | Same                   | Chagua mistari mingi ya msimbo                                                                                                  |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + f                         | Cmd + f                | Tafuta na ubadilishe katika hati ya sasa                                                                                        |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Ctrl + Shift + f                 | Cmd + Shift + f        | Pata faili (tafuta / badilisha katika hati nyingi)                                                                              |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Alt + l                          | Cmd + Option + l       | Mara msimbo uliochaguliwa                                                                                                       |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+
| Shift + Alt + l                  | Cmd + Shift + Option+l | Fungua msimbo uliochaguliwa                                                                                                     |
+----------------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------+

[***TIP:***]{style="color: darkgreen;"}*Tumia ufunguo wako wa Kichupo unapoandika ili kuhusisha utendakazi wa kukamilisha kiotomatiki wa RStudio. Hii inaweza kuzuia makosa ya tahajia. Bonyeza Tab unapoandika ili kutoa menyu kunjuzi ya vitendaji na vipengee vinavyowezekana, kulingana na ulichoandika kufikia sasa*[.]{style="color: darkgreen;"}

<!-- ======================================================= -->

## Kazi {#functions}

Kazi ndizo msingi wa kutumia R. Kazi ni jinsi unavyofanya kazi na uendeshaji. Vipengele vingi vinakuja kusakinishwa na R, nyingi zaidi zinapatikana kwa kupakuliwa kwenye vifurushi (zilizofafanuliwa katika sehemu ya [vifurushi](#packages)), na unaweza hata kuandika kazi zako za desturi!

Sehemu hii ya msingi juu ya kazi inaelezea:

• Taratibu ni nini na jinsi zinavyofanya kazi

• Je, hoja za utendaji ni zipi

• Jinsi ya kupata usaidizi kuelewa utendaji

Ujumbe wa haraka juu ya sintaksia: Katika kitabu hiki cha mwongozo, vitendaji vimeandikwa kwa maandishi ya msimbo na mabano yaliyo wazi, kama hii: chujio(). Kama ilivyoelezewa katika sehemu ya vifurushi, utendakazi hupakuliwa ndani ya vifurushi. Katika kitabu hiki cha mwongozo, majina ya vifurushi yameandikwa kwa herufi nzito, kama vile dplyr. Wakati mwingine katika msimbo wa mfano unaweza kuona jina la kazi likiwa limeunganishwa kwa uwazi na jina la kifurushi chake na koloni mbili (::) kama hii: dplyr::filter(). Madhumuni ya uunganisho huu yamefafanuliwa katika sehemu ya vifurushi.

<!-- ======================================================= -->

### Vitendaji Rahisi {.unnumbered}

**Chaguo za kukokotoa ni kama mashine inayopokea pembejeo, hufanya kitendo fulani na ingizo hizo, na kutoa pato.** Pato ni nini inategemea kazi.

**Utendakazi kwa kawaida hufanya kazi kwenye baadhi ya kitu kilichowekwa ndani ya mabano ya chaguo za kukokotoa.** Kwa mfano, chaguo za kukokotoa sqrt() hukokotoa mzizi wa mraba wa nambari.

```{r basics_function_sqrt}
sqrt(49)
```

Kitu kilichotolewa kwa chaguo za kukokotoa pia kinaweza kuwa safu wima katika mkusanyiko wa data (tazama sehemu ya Vipengee kwa undani juu ya aina zote za vitu). Kwa sababu R inaweza kuhifadhi hifadhidata nyingi, utahitaji kubainisha mkusanyiko wa data na safu wima. Njia moja ya kufanya hivyo ni kutumia nukuu ya \$ kuunganisha jina la seti ya data na jina la safu wima (dataset\$column). Katika mfano ulio hapa chini, muhtasari wa chaguo la kukokotoa () unatumika kwa umri wa safu wima ya nambari katika orodha ya mkusanyiko wa data, na matokeo ni muhtasari wa nambari za safu wima na thamani zinazokosekana.

```{r basics_functions_summary}
# Print summary statistics of column 'age' in the dataset 'linelist'
summary(linelist$age)
```

[***KUMBUKA:*** Nyuma ya pazia, chaguo la kukokotoa linawakilisha msimbo changamano wa ziada ambao umefungwa kwa mtumiaji kuwa amri moja rahisi.]{style="color: black;"}

<!-- ======================================================= -->

### **Hufanya kazi zenye hoja nyingi** {.unnumbered}

Mara nyingi utendakazi huomba pembejeo kadhaa, zinazoitwa **hoja**, ziko ndani ya mabano ya chaguo za kukokotoa, kwa kawaida hutenganishwa na koma.

• Baadhi ya hoja zinahitajika ili chaguo la kukokotoa lifanye kazi ipasavyo, zingine ni za hiari

• Hoja za hiari zina mipangilio chaguo-msingi

• Hoja zinaweza kuchukua herufi, nambari, kimantiki (TRUE/FALSE), na michango mingine

Hapa kuna kazi ya kubuni ya kufurahisha, inayoitwa oven_bake(), kama mfano wa utendaji wa kawaida. Huchukua kitu cha kuingiza (k.m. seti ya data, au katika mfano huu "unga") na kuifanyia shughuli kama ilivyobainishwa na hoja za ziada (dakika = na halijoto =). Matokeo yanaweza kuchapishwa kwa koni, au kuhifadhiwa kama kitu kwa kutumia opereta ya kazi `<-`.

```{r basics_functions_image, echo=F, out.width = "75%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Function_Bread_Example.png"))
```

**Katika mfano halisi zaidi**, age_pyramid() amri hapa chini hutoa piramidi ya umri kulingana na vikundi vya umri vilivyobainishwa na safu mgawanyiko ya jozi, kama vile jinsia. Chaguo za kukokotoa hupewa hoja tatu ndani ya mabano, zikitenganishwa na koma. Thamani zinazotolewa kwa hoja zinathibitisha orodha ya mstari kama mfumo wa data wa kutumia, age_cat5 kama safu wima ya kuhesabu, na jinsia kama safu ya jozi ya kutumia kugawanya piramidi kwa rangi.

```{r basics_functions_arguments, include=FALSE, results='hide', message=FALSE, warning=FALSE,}
## create an age group variable by specifying categorical breaks
linelist$age_group <- cut(linelist$age, breaks = c(0, 5, 10, 15, 20, 30, 45, 60))
```

```{r message=FALSE, warning=FALSE,  out.width = "75%", out.height="75%"}
# Create an age pyramid
age_pyramid(data = linelist, age_group = "age_cat5", split_by = "gender")
```

Amri iliyo hapo juu inaweza kuandikwa kwa usawa kama ilivyo hapo chini, kwa mtindo mrefu na mstari mpya kwa kila hoja. Mtindo huu unaweza kuwa rahisi kusoma, na rahisi kuandika "maoni" na \# kuelezea kila sehemu (kutoa maoni kwa upana ni mazoezi mazuri!). Ili kutekeleza amri hii ndefu unaweza kuonyesha amri nzima na ubofye "Run", au tu kuweka mshale wako kwenye mstari wa kwanza na kisha bonyeza Ctrl na Ingiza funguo wakati huo huo.

```{r message=FALSE, warning=FALSE,  out.width = "75%", out.height="75%"}
# Create an age pyramid
age_pyramid(
  data = linelist,        # use case linelist
  age_group = "age_cat5", # provide age group column
  split_by = "gender"     # use gender column for two sides of pyramid
  )
```

Nusu ya kwanza ya mgawo wa hoja (k.m. data =) haihitaji kubainishwa ikiwa hoja zimeandikwa kwa mpangilio maalum (uliobainishwa katika hati za chaguo la kukokotoa). Msimbo ulio hapa chini hutoa piramidi sawa na hapo juu, kwa sababu chaguo la kukokotoa linatarajia mpangilio wa hoja: fremu ya data, tofauti_ya kikundi, split_by kutofautiana.

```{r, basics_functions_pyramid2, eval = FALSE, warning=FALSE, message=FALSE, , out.width = "75%", out.height="75%", eval=F}
# This command will produce the exact same graphic as above
age_pyramid(linelist, "age_cat5", "gender")
```

**Amri changamano zaidi age_pyramid() inaweza kujumuisha hoja za hiari kwa:**

-   Onyesha uwiano badala ya hesabu (weka sawia = TRUE wakati chaguo-msingi ni FALSE)\
-   Bainisha rangi mbili za kutumia (pal = ni kifupi cha "palette" na imetolewa na vekta ya majina mawili ya rangi. Angalia ukurasa wa[vipengee](#objectstructure) jinsi chaguo za kukokotoa c() hutengeneza yekta.)

[***KUMBUKA:*** Kwa hoja ambazo unabainisha na sehemu zote mbili za hoja (k.m. proportional = TRUE), mpangilio wao kati ya hoja zote haujalishi.]{style="color: black;"}

```{r message=FALSE, warning=FALSE, out.width = "75%", out.height="75%"}
age_pyramid(
  linelist,                    # use case linelist
  "age_cat5",                  # age group column
  "gender",                    # split by gender
  proportional = TRUE,         # percents instead of counts
  pal = c("orange", "purple")  # colors
  )
```

<!-- ======================================================= -->

### Kuandika Kazi {.unnumbered}

R ni lugha inayoelekezwa kwenye vitendaji, kwa hivyo unapaswa kujisikia kuwa na uwezo wa kuandika vitendaji vyako mwenyewe. Kuunda kazi huleta faida kadhaa:

• Kuwezesha upangaji wa kawaida - utenganisho wa msimbo hadi vipande huru na vinavyoweza kudhibitiwa

• Badilisha nakala-na-kubandika inayorudiwa, ambayo inaweza kuwa na makosa

• Taja vipande vya msimbo majina ya kukumbukwa

Jinsi ya kuandika chaguo la kukokotoa imefunikwa kwa kina katika ukurasa wa vitendaji vya Kuandika. Ukurasa wa [Kuandika Kazi].

<!-- A function is given a name and defined with the assignment operator `<-` to a special **base** R function called `function()`. Within the parentheses, the arguments that the function will accept are defined. This is followed by curly brackets `{ }`, within which the actual code of the function is written.     -->

```{r, eval=F, echo=F}
my_function <- function( ARGUMENTS HERE ){ CODE HERE }
```

<!-- The arguments should be provided in the syntax `argument = default`, separated by commas.   -->

<!-- Here is an example where we create a function `staff_calc()` to serve as a staffing calculator for COVID-19 case investigation and contact tracing calls.   -->

<!-- The arguments (inputs) and their default values will be:   -->

<!-- * `daily_cases = NULL` The number of new COVID-19 cases per day   -->

<!-- * `contacts_each = 5` The number contacts enumerated for each case   -->

<!-- * `time_case = 0.5`  Number of hours to complete a case investigaton by phone   -->

<!-- * `time_contact = 0.25`  Number of hours to complete a contact follow-up by phone   -->

<!-- * `time_day = 8` The number of hours one staff works per day   -->

<!-- Below, the function is created. The code ends with the special function `return()`, which is what the function produces.    -->

<!-- ```{r message=FALSE, warning=FALSE, out.width = "75%", out.height="75%"} -->

<!-- staff_calc <- function(daily_cases = NULL, contacts_each = 5, -->

<!--                        time_case = 0.5, time_contact = 0.25, time_day = 8){ -->

<!--   # Define total daily hours for calling cases -->

<!--   case_hours <- daily_cases * time_case  -->

<!--   # Define total daily hours for calling contacts -->

<!--   contact_hours <- daily_cases * contacts_each * time_contact -->

<!--   # Calculate number of staff required -->

<!--   staff_required <- (case_hours + contact_hours)/time_day -->

<!--   return(staff_required) -->

<!-- } -->

<!-- ``` -->

<!-- Once this code is run, the function will be defined and will appear in the R Environment. We can run the function. Below all the default values are used and the `daily_cases = ` is set to 150.   -->

```{r eval=F, echo=F, message=FALSE, warning=FALSE, out.width = "75%", out.height="75%"}
staff_calc(daily_cases = 150)
```

```{r, eval=F, echo=F}
case_incidence <- tibble(
  dates = seq.Date(from = as.Date("2020-05-01"), to = as.Date("2020-05-21"), by = 1),
  projected_incidence = c(102,110,50,37,106,190,146,138,135,111,60,43,189,184,185,80,44,97,254,291,288),
  staff_needed = staff_calc(projected_incidence)
)

ggplot(case_incidence, aes(x = dates))+
  geom_line(aes(y = projected_incidence))+
  geom_line(aes(y = staff_needed))
```

<!-- There are many other nuances to understand when writing functions, as discussed in the page [Writing functions].   -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Vifurushi {#packages}

**Vifurushi vina vitendaji.**

Kifurushi cha R ni kifurushi cha msimbo na hati zinazoweza kushirikiwa ambazo zina vitendaji vilivyobainishwa awali. Watumiaji katika jumuiya ya R hutengeneza vifurushi kila wakati vinavyoshughulikia matatizo mahususi, kuna uwezekano kwamba mtu anaweza kukusaidia katika kazi yako! Utasakinisha na kutumia mamia ya vifurushi katika matumizi yako ya R.

Wakati wa usakinishaji, R ina vifurushi vya "msingi" na kazi zinazofanya kazi za msingi za kawaida. Lakini watumiaji wengi wa R huunda vitendaji maalum, ambavyo vinathibitishwa na jumuiya ya R na ambavyo unaweza kupakua kama kifurushi kwa matumizi yako mwenyewe. Katika kijitabu hiki, majina ya vifurushi yameandikwa kwa herufi nzito. Mojawapo ya mambo yenye changamoto zaidi ya R ni kwamba mara nyingi kuna chaguo nyingi za kukokotoa au vifurushi ili kukamilisha kazi fulani.

### Sanikisha na upakie {.unnumbered}

Kazi zimo ndani ya vifurushi ambavyo vinaweza kupakuliwa ("vimewekwa") kwenye kompyuta yako kutoka kwa mtandao. Mara kifurushi kinapopakuliwa, huhifadhiwa kwenye "maktaba" yako. Kisha unaweza kufikia vitendaji vilivyomo wakati wa kipindi chako cha sasa cha R kwa "kupakia" kifurushi.

Fikiria R kama maktaba yako ya kibinafsi: Unapopakua kifurushi, maktaba yako hupata kitabu kipya cha vitendaji, lakini kila wakati unapotaka kutumia chaguo la kukokotoa katika kitabu hicho, lazima uazima ("pakia") kitabu hicho kutoka kwa maktaba yako.

Kwa muhtasari: kutumia kazi zinazopatikana kwenye kifurushi cha R, hatua 2 lazima zitekelezwe:

1\. Mfuko lazima umewekwa (mara moja), na

2\. Kifurushi lazima kipakiwe (kila kipindi cha R)

#### Maktaba yako {.unnumbered}

"Maktaba" yako ni folda kwenye kompyuta yako, iliyo na folda kwa kila kifurushi ambacho kimesakinishwa. Jua wapi R imewekwa kwenye kompyuta yako, na utafute folda inayoitwa "win-maktaba". Kwa mfano: R\\win-library\\4.0 (4.0 ni toleo la R - utakuwa na maktaba tofauti kwa kila toleo la R ambalo umepakua).

Unaweza kuchapisha njia ya faili kwenye maktaba yako kwa kuingiza .libPaths() (mabano tupu). Hii inakuwa muhimu hasa ikiwa unafanya kazi na R kwenye anatoa za mtandao.

#### Sakinisha kutoka CRAN {.unnumbered}

Mara nyingi, watumiaji wa R hupakua vifurushi kutoka kwa CRAN. CRAN (Comprehensive R Archive Network) ni ghala la mtandaoni la vifurushi vya R ambavyo vimechapishwa na wanajamii wa R..

*J*e, una wasiwasi kuhusu virusi na usalama unapopakua kifurushi kutoka kwa CRAN? Soma [makala hi](https://support.rstudio.com/hc/en-us/articles/360042593974-R-and-R-Package-Security)i uu ya mada.

#### Jinsi ya kufunga na kupakia {.unnumbered}

Katika kitabu hiki cha mwongozo, tunapendekeza kutumia kifurushi cha pacman (kifupi cha "kidhibiti kifurushi"). Inatoa kazi rahisi p_load() ambayo itasakinisha kifurushi ikiwa ni lazima na kuipakia kwa matumizi katika kipindi cha sasa cha R.

Syntax rahisi sana. Orodhesha tu majina ya vifurushi ndani ya p_load() mabano, yaliyotenganishwa na koma. Amri hii itasakinisha rio, tidyverse, na vifurushi hapa ikiwa bado hazijasakinishwa, na itapakia kwa matumizi. Hii inafanya p_load() mbinu kuwa rahisi na fupi ikiwa unashiriki hati na wengine. Kumbuka kuwa majina ya vifurushi ni nyeti kwa kadiri.

```{r}
# Install (if necessary) and load packages for use
pacman::p_load(rio, tidyverse, here)
```

Kumbuka kuwa tumetumia syntax pacman::p_load() ambayo huandika kwa uwazi jina la kifurushi (pacman) kabla ya jina la chaguo-kazi (p_load()), iliyounganishwa na koloni mbili ::. Syntax hii ni muhimu kwa sababu pia inapakia kifurushi cha pacman (ikizingatiwa kuwa tayari kimewekwa).

Kuna chaguo mbadala za msingi za R ambazo utaona mara nyingi. Chaguo za msingi za R za kusakinisha kifurushi ni install.packages(). Jina la kifurushi cha kusakinisha lazima litolewe kwenye mabano katika nukuu. Ikiwa unataka kusakinisha vifurushi vingi kwa amri moja, lazima ziorodheshwe ndani ya vekta ya herufi c().

Kumbuka: amri hii husakinisha kifurushi, lakini haipakii kwa matumizi katika kipindi cha sasa.

```{r, eval=F}
# install a single package with base R
install.packages("tidyverse")

# install multiple packages with base R
install.packages(c("tidyverse", "rio", "here"))
```

Usakinishaji unaweza pia kukamilishwa kwa kubofya-na-kubonyeza kwa kwenda kwenye kidirisha cha "Vifurushi" cha RStudio na kubofya "Sakinisha" na kutafuta jina la kifurushi unachotaka.

Kazi ya msingi ya R kupakia kifurushi kwa matumizi (baada ya kusakinishwa) ni maktaba(). Inaweza kupakia kifurushi kimoja tu kwa wakati mmoja (sababu nyingine ya kutumia p_load()). Unaweza kutoa jina la kifurushi na au bila manukuu.

```{r, eval=F}
# load packages for use, with base R
library(tidyverse)
library(rio)
library(here)
```

Ili kuangalia ikiwa kifurushi kimesakinishwa na/au kupakiwa, unaweza kutazama kidirisha cha Vifurushi katika RStudio. Ikiwa kifurushi kimewekwa, kinaonyeshwa hapo na nambari ya toleo. Ikiwa kisanduku chake kimeangaliwa, kinapakiwa kwa kikao cha sasa

**Sanikisha kutoka kwa Github**

Wakati mwingine, unahitaji kusakinisha kifurushi ambacho bado hakipatikani kutoka kwa CRAN. Au labda kifurushi kinapatikana kwenye CRAN lakini unataka toleo la ukuzaji lenye vipengele vipya ambavyo bado havijatolewa katika toleo thabiti zaidi lililochapishwa la CRAN. Hizi mara nyingi hupangishwa kwenye tovuti ya [github.com](https://github.com/) katika msimbo wa bure, unaoangalia umma "hazina". Soma zaidi kuhusu Github kwenye ukurasa wa kitabu juu ya Udhibiti wa Toleo na ushirikiano na Git na Github.

Ili kupakua vifurushi vya R kutoka Github, unaweza kutumia kazi p_load_gh() kutoka pacman, ambayo itasakinisha kifurushi ikiwa ni lazima, na kukipakia kwa matumizi katika kipindi chako cha sasa cha R. Njia mbadala za kusakinisha ni pamoja na kutumia vidhibiti vya mbali au vifurushi vya devtools. Soma zaidi juu ya kazi zote za pacman kwenye hati za kifurushi.

Ili kusakinisha kutoka kwa Github, lazima utoe maelezo zaidi. Lazima utoe:

1\. Kitambulisho cha Github cha mmiliki wa hazina

2\. Jina la hazina ambayo ina kifurushi

3\. (si lazima) Jina la "tawi" (toleo mahususi la ukuzaji) unalotaka kupakua.

Katika mifano hapa chini, neno la kwanza katika alama za nukuu ni Kitambulisho cha Github cha mmiliki wa hifadhi, baada ya kufyeka ni jina la hazina (jina la kifurushi).

```{r, eval=F}
# install/load the epicontacts package from its Github repository
p_load_gh("reconhub/epicontacts")
```

Ikiwa ungependa kusakinisha kutoka kwa "tawi" (toleo) isipokuwa tawi kuu, ongeza jina la tawi baada ya "\@", baada ya jina la hifadhi..

```{r, eval=F}
# install the "timeline" branch of the epicontacts package from Github
p_load_gh("reconhub/epicontacts@timeline")
```

Ikiwa hakuna tofauti kati ya toleo la Github na toleo kwenye kompyuta yako, hakuna hatua itachukuliwa. Unaweza "kulazimisha" kusakinisha tena kwa kutumia p_load_current_gh() na sasisho la `update = TRUE`. Soma zaidi kuhusu **pacman** kwenye [vignette](http://trinker.github.io/pacman/vignettes/Introduction_to_pacman.html) mtandaoni.

**Sanikisha kutoka kwa ZIP au TAR**

Unaweza kusanikisha kutoka mtandaoni ukitumia tovuti:

```{r, eval=F}
packageurl <- "https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
```

Au, pakua kwenye kompyuta yako katika faili iliyofungwa:

Chaguo 1: kutumia install_local() kutoka kwa kifurushi cha **remotes**.

```{r, eval=F}
remotes::install_local("~/Downloads/dplyr-master.zip")
```

Chaguo la 2: kutumia install.packages() kutoka msingi R, kutoa njia ya faili kwa faili ya ZIP na mpangilio `type = "source` and `repos = NULL`.

```{r, eval=F}
install.packages("~/Downloads/dplyr-master.zip", repos=NULL, type="source")
```

### Sintaksia ya msimbo {.unnumbered}

Kwa uwazi katika kitabu hiki cha mwongozo, utendakazi wakati mwingine hutanguliwa na jina la kifurushi chao kwa kutumia :: ishara kwa njia ifuatayo: `package_name::function_name()`

Mara tu kifurushi kinapopakiwa kwa kipindi, mtindo huu wazi sio lazima. Mtu anaweza kutumia tu function_name(). Walakini kuandika jina la kifurushi ni muhimu wakati jina la kazi ni la kawaida na linaweza kuwepo katika vifurushi vingi (kwa mfano plot()). Kuandika jina la kifurushi pia kutapakia kifurushi ikiwa bado hakijapakiwa.

```{r eval=FALSE}
# This command uses the package "rio" and its function "import()" to import a dataset
linelist <- rio::import("linelist.xlsx", which = "Sheet1")
```

### Usaidizi wa Kazi {.unnumbered}

Ili kusoma zaidi kuhusu chaguo za kukokotoa, unaweza kuitafuta kwenye kichupo cha Usaidizi cha RStudio ya chini kulia. Unaweza pia kutekeleza amri kama ?thefunctionname (weka jina la chaguo la kukokotoa baada ya alama ya kuuliza) na ukurasa wa Usaidizi utaonekana kwenye kidirisha cha Usaidizi. Hatimaye, jaribu kutafuta rasilimali mtandaoni.

### Sasisha vifurushi {.unnumbered}

Unaweza kusasisha vifurushi kwa kusakinisha tena. Unaweza pia kubofya kitufe cha kijani cha "Sasisha" kwenye kidirisha cha Vifurushi vya RStudio ili kuona ni vifurushi vipi vina matoleo mapya ya kusakinisha. Fahamu kuwa nambari yako ya zamani inaweza kuhitaji kusasishwa ikiwa kuna marekebisho makubwa ya jinsi chaguo la kukokotoa linavyofanya kazi!

### Futa vifurushi {.unnumbered}

Tumia p_delete() kutoka pacman, au remove.packages() kutoka msingi R. Vinginevyo, nenda utafute folda iliyo na maktaba yako na ufute folda wewe mwenyewe..

### Vitegemezi {.unnumbered}

Vifurushi mara nyingi hutegemea vifurushi vingine kufanya kazi. Hizi huitwa utegemezi. Ikiwa utegemezi utashindwa kusakinisha, basi kifurushi kinachotegemea kinaweza pia kushindwa kusakinisha.

Tazama utegemezi wa kifurushi na p_depends(), na uone ni vifurushi vipi vinavyotegemea na p_depends_reverse()

### Vitendaji vilivyofichwa {.unnumbered}

Sio kawaida kwamba vifurushi viwili au zaidi vina jina la utendakazi sawa. Kwa mfano, dplyr ya kifurushi ina kichungi() kazi, lakini ndivyo takwimu za kifurushi. Kichujio cha chaguo-msingi () kinategemea mpangilio wa vifurushi hivi kwa mara ya kwanza kwenye kikao cha R - cha baadaye kitakuwa chaguo-msingi kwa kichujio cha amri ().

Unaweza kuangalia agizo kwenye kidirisha chako cha Mazingira cha R Studio - bofya menyu kunjuzi ya "Mazingira ya Ulimwenguni" na uone mpangilio wa vifurushi. Chaguo za kukokotoa kutoka kwa vifurushi vilivyo chini ya orodha hiyo kunjuzi zitaficha utendakazi wa jina moja katika vifurushi vinavyoonekana juu zaidi katika orodha kunjuzi. Wakati wa kupakia kifurushi kwanza, R itakuonya kwenye koni ikiwa masking inatokea, lakini hii inaweza kuwa rahisi kukosa.

```{r out.width = "50%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "masking_functions.png"))
```

Hapa kuna njia ambazo unaweza kurekebisha masking:

1\. Taja jina la kifurushi katika amri. Kwa mfano, tumia dplyr::filter()

2\. Panga upya mpangilio ambao vifurushi vinapakiwa (k.m. ndani ya p_load()), **na uanze kipindi kipya cha R.**

### Ondoa/Pakua {.unnumbered}

Ili kupata (kupakua) kifurushi, tumia amri hii, na jina sahihi la kifurushi na koloni moja tu. Kumbuka kwamba hii inaweza kutatua masking.

```{r, eval=F}
detach(package:PACKAGE_NAME_HERE, unload=TRUE)
```

### Sakinisha toleo la zamani {.unnumbered}

Tazama [mwongozo](https://support.rstudio.com/hc/en-us/articles/219949047-Installing-older-versions-of-packages) huu ili kusakinisha toleo la zamani la kifurushi fulani.

### Vifurushi vilivyopendekezwa {.unnumbered}

Tazama ukurasa kwenye [Vifurushi vilivyopendekezwa] kwa uorodheshaji wa vifurushi tunavyopendekeza kwa epidemiologia ya kila siku.

<!-- ======================================================= -->

## Hati {#scripts}

Hati ni sehemu ya msingi ya upangaji programu. Ni hati zinazoshikilia amri zako (k.m. kazi za kuunda na kurekebisha seti za data, taswira za kuchapisha, n.k). Unaweza kuhifadhi hati na kuiendesha tena baadaye. Kuna faida nyingi za kuhifadhi na kuendesha amri zako kutoka kwa hati (dhidi ya kuandika amri moja baada ya nyingine kwenye "mstari wa amri" wa dashibodi ya R):

-   Kubebeka - unaweza kushiriki kazi yako na wengine kwa kuwatumia hati zako
-   Uzalishaji tena - ili wewe na wengine mjue ni nini hasa mlifanya
-   Udhibiti wa toleo - ili uweze kufuatilia mabadiliko yaliyofanywa na wewe mwenyewe
    au wafanyakazi wenza
-   Kutoa maoni/dokezo - kueleza wenzako ulichofanya

### Kutoa maoni {.unnumbered}

Katika hati unaweza pia kufafanua ("maoni") karibu na msimbo wako wa R. Kutoa maoni kunasaidia kujieleza mwenyewe na wasomaji wengine kile unachofanya. Unaweza kuongeza maoni kwa kuandika alama ya heshi (#) na kuandika maoni yako baada yake. Maandishi yaliyotolewa maoni yataonekana katika rangi tofauti na msimbo wa R.

Nambari yoyote iliyoandikwa baada ya \# haitaendeshwa. Kwa hivyo, kuweka \# kabla ya nambari pia ni njia muhimu ya kuzuia kwa muda safu ya nambari ("toa maoni") ikiwa hutaki kuifuta). Unaweza kutoa maoni/katika mistari mingi mara moja kwa kuiangazia na kubofya Ctrl+Shift+c (Cmd+Shift+c
katika Mac)..

```{r, eval = F}
# A comment can be on a line by itself
# import data
linelist <- import("linelist_raw.xlsx") %>%   # a comment can also come after code
# filter(age > 50)                          # It can also be used to deactivate / remove a line of code
  count()

```

-   Toa maoni yako juu ya kile unachofanya na kwa nini unakifanya.
-   Vunja msimbo wako katika sehemu zenye mantiki
-   Andanisha msimbo wako na maelezo ya hatua kwa hatua ya kile unachofanya (k.m. hatua zilizowekwa nambari)

### Style {.unnumbered}

Ni muhimu kufahamu mtindo wako wa uandishi - haswa ikiwa unafanya kazi kwenye timu. Tunatetea [mwongozo wa mtindo](https://style.tidyverse.org/). Pia kuna vifurushi kama vile **styler** na **lintr** ambavyo vinakusaidia kuendana na mtindo huu.

Mambo machache ya msingi sana ili kufanya msimbo wako usomeke kwa wengine:

\* Unapotaja vitu, tumia herufi ndogo tu, nambari, na mistari chini \_, k.m. my_data

\* Tumia nafasi za mara kwa mara, ikijumuisha karibu na waendeshaji, k.m. `n = 1` and `age_new <- age_old + 3`

### Mfano wa hati {.unnumbered}

Chini ni mfano wa hati fupi ya R. Kumbuka, kadri unavyoelezea kwa ufupi
nambari yako ya kuthibitisha kwenye maoni, ndivyo wenzako watakavyokupenda
zaidi!

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "example_script.png"))
```

<!-- ======================================================= -->

### Hati ya Alama ya R {.unnumbered}

Hati ya alama ya R ni aina ya hati ya R ambayo hati yenyewe inakuwa hati ya pato (PDF, Neno, HTML, Powerpoint, n.k.). Hizi ni zana muhimu sana na zinazotumika mara nyingi hutumika kuunda ripoti zinazobadilika na otomatiki. Hata tovuti hii na kitabu cha mwongozo kinatolewa kwa maandishi ya alama ya R!

Inafaa kumbuka kuwa watumiaji wa R wanaoanza wanaweza pia kutumia R Markdown - usiogope! Ili kupata maelezo zaidi, tazama ukurasa wa kitabu kwenye hati za \[Ripoti zilizo na R Markdown\].

<!-- ======================================================= -->

### Madaftari ya R {.unnumbered}

Hakuna tofauti kati ya kuandika kwenye Rmarkdown dhidi ya daftari la R. Hata hivyo
utekelezaji wa hati unatofautiana kidogo. Tazama [tovuti](http://uc-r.github.io/r_notebook) hii kwa maelezo zaidi.

<!-- ======================================================= -->

### Inang'aa {.unnumbered}

Programu/tovuti zinazong'aa zimo ndani ya hati moja, ambayo lazima iitwe app.R. Faili hii ina vipengele vitatu:

1\. Kiolesura cha mtumiaji (ui)

2\. Kazi ya seva

3\. Wito kwa kazi ya shinyApp

Tazama
ukurasa wa kitabu kwenye Dashibodi zenye Shiny, au mafunzo haya ya mtandaoni: [Mafunzo ya kung'aa](https://shiny.rstudio.com/tutorial/written-tutorial/lesson1/).

*Katika nyakati za zamani, faili iliyo hapo juu iligawanywa katika faili mbili (`ui.R` na `server.R`)*

### Kukunja msimbo {.unnumbered}

Unaweza kukunja sehemu za msimbo ili kurahisisha kusoma hati yako

Ili kufanya hivyo, unda kichwa cha maandishi na #, andika kichwa chako, na ufuate kwa angalau 4 ya deshi (-), heshi (#) au sawa (=). Unapofanya hivyo, mshale mdogo utaonekana kwenye "gutter" upande wa kushoto (kwa nambari ya safu). Unaweza kubofya mshale huu na msimbo ulio hapa chini hadi kichwa kifuatacho kikunje na ikoni ya mishale miwili itaonekana mahali pake.

Ili kupanua msimbo, ama ubofye mshale kwenye gutter tena, au ikoni ya mishale miwili. Pia kuna mikato ya kibodi kama ilivyoelezewa katika sehemu ya [RStudio ](#rstudio)ya ukuraha huu.

Kwa kuunda vichwa na #, pia utawasha Jedwali la Yaliyomo chini ya hati yako (tazama hapa chini) ambayo unaweza kutumia kuelekeza hati yako. Unaweza kuunda vichwa vidogo kwa kuongeza alama \# zaidi, kwa mfano \# za msingi, ## za upili, na ##\# kwa vichwa vya elimu ya juu.

Chini ni matoleo mawili ya hati ya mfano. Upande wa kushoto ni asili na vichwa vya maoni. Upande wa kulia, vistari vinne vimeandikwa baada ya kila kichwa, na hivyo kuzifanya kukunjwa.
Mbili kati yao zimeporomoka, na unaweza kuona kwamba Jedwali la Yaliyomo chini sasa linaonyesha kila sehemu.

```{r, out.width = c('50%'), fig.show='hold', echo=F}
knitr::include_graphics(here::here("images", "code_folding1.png"))
knitr::include_graphics(here::here("images", "code_folding2.png"))
```

Maeneo mengine ya msimbo ambayo yanastahiki kiotomatiki kukunjwa ni pamoja na maeneo
"yaliyounganishwa" yenye mabano { } kama vile ufafanuzi wa utendakazi au vizuizi vyenye masharti (ikiwa sivyo, taarifa). Unaweza kusoma zaidi kuhusu kukunja msimbo kwenye tovuti ya
[RStudio](https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections).

<!-- ======================================================= -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Saraka  ya kufanya kazi

Saraka ya kufanya kazi ni eneo la folda ya mizizi inayotumiwa na R kwa kazi yako - ambapo R hutafuta na kuhifadhi faili kwa chaguo-msingi. Kwa chaguomsingi, itahifadhi faili na matokeo mapya kwenye eneo hili, na itatafuta faili za kuagiza (k.m. seti za data) hapa pia.

Saraka ya kufanya kazi inaonekana katika maandishi ya kijivu juu ya kidirisha cha RStudio Console. Unaweza pia kuchapisha saraka ya sasa ya kufanya kazi kwa kukimbia getwd() (acha mabano tupu)..

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "working_directory_1.png"))
```

### Mbinu iliyopendekezwa {.unnumbered}

Tazama ukurasa kwenye \[miradi ya R\] kwa maelezo juu ya mbinu yetu inayopendekezwa ya
kudhibiti saraka yako ya kufanya kazi.

Njia ya kawaida, bora, na isiyo na shida ya kudhibiti saraka yako ya kufanya kazi na njia za faili ni kuchanganya vitu hivi 3 katika mtiririko wa kazi unaoelekezwa kwa mradi wa R:

1\. Mradi wa R wa kuhifadhi faili zako zote (tazama ukurasa kwenye miradi ya R)

2\. Kifurushi hapa cha kupata faili (tazama ukurasa kwenye Ingiza na Hamisha)

3\. Kifurushi cha rio cha kuagiza/kusafirisha nje faili (tazama ukurasa wa Kuingiza na kuuza nje)

<!-- ======================================================= -->

### Imewekwa kwa amri {.unnumbered}

Hadi hivi majuzi, watu wengi wanaojifunza R walifundishwa kuanza maandishi yao na setwd() amri. Tafadhali zingatia kutumia mtiririko wa kazi unaoelekezwa kwa mradi wa R na usome [sababu za kutotumia `setwd()`](https://www.tidyverse.org/blog/2017/12/workflow-vs-script/). Kwa ufupi, kazi yako inakuwa mahususi kwa kompyuta yako, njia za faili zinazotumiwa kuleta na kuhamisha faili huwa "dhaifu", na hii inazuia kwa kiasi kikubwa ushirikiano na matumizi ya msimbo wako kwenye kompyuta nyingine yoyote. Kuna njia mbadala rahisi!

Kama ilivyoonyeshwa hapo juu, ingawa hatupendekezi njia hii katika hali nyingi, unaweza kutumia amri setwd() na njia ya faili ya folda inayotaka katika nukuu, kwa mfano:

```{r, eval=F}
setwd("C:/Documents/R Files/My analysis")
```

[***HATARI:*** Kuweka saraka ya kufanya kazi na setwd() inaweza kuwa "brittle" ikiwa ni maalum kwa kompyuta moja. Badala yake, tumia njia za faili zinazohusiana na saraja ya mizizi ya Miradi ya R( na kifurushi hapa).]{style="color: red;"}

<!-- ======================================================= -->

### Weka kwa mikono {.unnumbered}

Ili kuweka saraka ya kufanya kazi mwenyewe (hakika-na-bofya sawa na setwd()), bofya menyu kunjuzi ya Kipindi na uende kwenye "Weka Orodha ya Kufanya Kazi" na kisha "Chagua Saraka". Hii itaweka saraka ya kufanya kazi kwa kikao hicho maalum cha R. Kumbuka: ukitumia mbinu hii, itabidi ufanye hivi kwa mikono kila wakati unapofungua RStudio..

<!-- ======================================================= -->

### Ndani ya mradi wa R {.unnumbered}

Ikiwa unatumia mradi wa R, saraka ya kufanya kazi itakuwa chaguomsingi kwa folda ya msingi ya mradi wa R ambayo ina faili ya ".rproj". Hii itatumika ukifungua RStudio kwa kubofya fungua Mradi wa R (faili iliyo na kiendelezi cha ".rproj")..

<!-- ======================================================= -->

### Saraka ya kufanya kazi katika alama ya R {.unnumbered}

Katika hati ya alama ya R, saraka ya chaguo-msingi ya kufanya kazi ni folda ambayo faili ya Rmarkdown (.Rmd) imehifadhiwa ndani. Ikiwa unatumia mradi wa R na hapa kifurushi, hii haitumiki na saraka ya kufanya kazi itakuwa hapa() kama ilivyoelezewa kwenye ukurasa wa miradi ya R.

Ikiwa unataka kubadilisha saraka ya kufanya kazi ya alama ya R ya kusimama pekee (sio katika mradi wa R), ikiwa unatumia setwd() hii itatumika tu kwa chunk hiyo maalum ya nambari. Ili kufanya mabadiliko ya vijisehemu vyote vya msimbo katika alama ya R, hariri sehemu ya usanidi ili kuongeza root.dir = parameta, kama vile hapa chini::

```{r, eval=F}
knitr::opts_knit$set(root.dir = 'desired/directorypath')
```

Ni rahisi zaidi kutumia alama ya R ndani ya mradi wa R na kutumia hapa kifurushi.

<!-- ======================================================= -->

### Kutoa njia za faili {.unnumbered}

Labda chanzo cha kawaida cha kufadhaika kwa mwanzilishi wa R (angalau kwenye mashine ya Windows) ni kuandika kwenye njia ya faili ili kuagiza au kusafirisha data. Kuna maelezo kamili ya jinsi ya kuweka njia bora za faili katika ukurasa wa Kuingiza na kuuza nje, lakini hapa kuna mambo machache muhimu:

**Njia zilizovunjika**

Chini ni mfano wa njia ya faili "kabisa" au "anwani kamili". Hizi zinaweza kuvunjika ikiwa zitatumiwa na kompyuta nyingine. Isipokuwa moja ni ikiwa unatumia hifadhi ya pamoja/mtandao.

    C:/Users/Name/Document/Analytic Software/R/Projects/Analysis2019/data/March2019.csv  

**Mwelekeo wa kufyeka**

*Ikiwa unaandika kwenye njia ya faili, fahamu mwelekeo wa mikwaju.* Tumia mikwaju ya mbele (/) kutenganisha vipengele ("data/provincial.csv"). Kwa watumiaji wa Windows, njia chaguo-msingi ambayo njia za faili zinaonyeshwa ni kwa mikwaju ya nyuma (\\) - kwa hivyo utahitaji kubadilisha mwelekeo wa kila kufyeka. Ikiwa unatumia hapa kifurushi kama ilivyoelezewa kwenye ukurasa wa miradi ya R mwelekeo wa kufyeka sio suala.

**Njia za faili za jamaa**

Kwa ujumla tunapendekeza kutoa njia za faili "jamaa" badala yake - yaani, njia inayohusiana na mzizi wa Mradi wako wa R. Unaweza kufanya hivyo kwa kutumia hapa kifurushi kama ilivyoelezewa kwenye ukurasa wa miradi ya R. Njia ya faili ya jamaa inaweza kuonekana kama
hii:

```{r, eval=F}
# Import csv linelist from the data/linelist/clean/ sub-folders of an R project
linelist <- import(here("data", "clean", "linelists", "marin_country.csv"))
```

Hata ikiwa unatumia njia za faili za jamaa ndani ya mradi wa R, bado unaweza kutumia njia kamili kuagiza/kusafirisha data nje ya mradi wako wa R.

<!-- ======================================================= -->

## Vitu {#objects}

Kila kitu katika R ni kitu, na R ni lugha "inayoelekezwa kwa kitu". Sehemu hizi zitafafanua:

• Jinsi ya kuunda vitu (\<-)

• Aina za vitu (k.m. fremu za data, vekta..)

• Jinsi ya kufikia sehemu ndogo za vitu (k.m. vigeuzo katika mkusanyiko wa data)

• Aina za vitu (k.m. nambari, mantiki, nambari kamili, mbili, herufi, kipengele)

<!-- ======================================================= -->

### Kila kitu ni kitu {.unnumbered}

Sehemu hii imechukuliwa kutoka kwa mradi wa [R4Epis ](https://r4epis.netlify.app/training/r_basics/objects/)\
Kila kitu unachohifadhi katika R - seti za data, vigezo, orodha ya majina ya vijiji, jumla ya idadi ya watu, hata matokeo kama vile grafu - ni vitu ambavyo vimepewa jina na vinaweza kurejelewa katika amri za baadaye.

Kitu kinapatikana wakati umekikabidhi thamani (tazama sehemu ya kazi hapa chini). Inapopewa dhamana, kitu huonekana kwenye Mazingira (tazama kidirisha cha juu cha kulia cha RStudio). Kisha inaweza kuendeshwa, kubadilishwa, kubadilishwa na kufafanuliwa upya..

<!-- ======================================================= -->

### Kufafanua vitu (`<-`) {.unnumbered}

**Unda vitu kwa kuvipa thamani na operator \<-**\
Unaweza kufikiria opereta wa kazi \<- kama maneno "yamefafanuliwa kama".
Amri za mgawo kwa ujumla hufuata agizo la kawaida:

**jina_la_kitu** \<- **thamani** (*au mchakato/hesabu ambayo hutoa thamani*)

Kwa mfano, unaweza kutaka kurekodi wiki ya sasa ya kuripoti magonjwa kama kitu cha kurejelea katika msimbo wa baadaye. Katika mfano huu, kitu current_week huundwa wakati kimepewa thamani "2018-W10" (alama za nukuu hufanya hii kuwa thamani ya mhusika). Kitu
current_week kitaonekana kwenye kidirisha cha Mazingira cha RStudio (juu-kulia) na kinaweza kurejelewa katika amri za baadaye.

Tazama amri za R na matokeo yao kwenye visanduku vilivyo hapa chini.

```{r basics_objects_assignment}
current_week <- "2018-W10"   # this command creates the object current_week by assigning it a value
current_week                 # this command prints the current value of current_week object in the console
```

[***KUMBUKA:*** *Kumbuka `[1]` katika pato la koni ya R inaonyesha tu kuwa unatazama kipengee cha kwanza cha matokeo*. ]{style="color: black;"}

[***TAHADHARI:*** *T**hamani ya kitu inaweza kuandikwa** zaidi wakati wowote kwa kutekeleza amri ya mgawo ili jkufafanua tena thamani yake. Hivyo, **utaratibu wa amri kukimbia ni muhimu sana.*** ]{style="color: orange;"}

Amri ifuatayo itafafanua tena thamani ya `current_week`:

```{r basics_objects_reassignment}
current_week <- "2018-W51"   # assigns a NEW value to the object current_week
current_week                 # prints the current value of current_week in the console
```

**Ishara sawa `=`**

Pia utaona ishara sawa katika nambari ya R:

-   Ishara ya usawa maradufu == kati ya vitu viwili au thamani inauliza swali la kimantiki: "hii ni sawa na ile?".

-   Pia utaona ishara sawa ndani ya vitendakazi vinavyotumiwa kubainisha thamani za hoja za chaguo za kukokotoa (soma kuhusu hizi katika sehemu zilizo hapa chini), kwa mfano max(age, na.rm = TRUE).

-   Unaweza kutumia ishara moja ya usawa = badala ya \<- kuunda na kufafanua vitu, lakini hii
    imekatishwa tamaa. Unaweza kusoma kuhusu kwa nini hii inakatishwa tamaa [hapa](https://renkun.me/2014/01/28/difference-between-assignment-operators-in-r/).

**Seti za data**

Seti za data pia ni vitu (kawaida "fremu za data") na lazima zipewe majina zinapoingizwa. Katika msimbo ulio hapa chini, orodha ya kitu imeundwa na kupewa thamani ya faili ya CSV iliyoingizwa na kifurushi cha rio na kitendakazi chake cha import()..

```{r basics_objects_dataframes, eval=FALSE}
# linelist is created and assigned the value of the imported CSV file
linelist <- import("my_linelist.csv")
```

Unaweza kusoma zaidi kuhusu kuagiza na kuhamisha hifadhidata kwa sehemu ya Leta na
Hamisha.

[***TAHADHARI:*** Dokezo la haraka kuhusu kutaja vitu:]{style="color: orange;"}

-   Majina ya vitu lazima yasiwe na nafasi, lakini unapaswa kutumia mstari chini (\_) au kipindi (.) badala ya nafasi.
-   Majina ya vitu ni nyeti kwa kadiri (ikimaanisha kuwa Dataset_A ni tofauti na seti_A).
-   Majina ya vitu lazima yaanze na herufi (haiwezi kuanza na nambari kama 1, 2 au 3)..

**Matokeo**

Matokeo kama vile majedwali na viwanja hutoa mfano wa jinsi matokeo yanaweza kuhifadhiwa kama vitu, au kuchapishwa tu bila kuhifadhiwa. Ujumlisho mtambuka wa jinsia na matokeo kwa kutumia jedwali la msingi la kukokotoa la R linaweza kuchapishwa moja kwa moja kwenye dashibodi ya R (bila kuhifadhiwa)..

```{r}
# printed to R console only
table(linelist$gender, linelist$outcome)
```

Lakini jedwali sawa linaweza kuhifadhiwa kama kitu kilichopewa jina. Kisha, kwa hiari, inaweza kuchapishwa.

```{r}
# save
gen_out_table <- table(linelist$gender, linelist$outcome)

# print
gen_out_table
```

**Columns**

Columns in a dataset are also objects and can be defined, over-written, and created as described below in the section on Columns.

You can use the assignment operator from **base** R to create a new column. Below, the new column `bmi` (Body Mass Index) is created, and for each row the new value is result of a mathematical operation on the row's value in the `wt_kg` and `ht_cm` columns.

```{r, eval=F}
# create new "bmi" column using base R syntax
linelist$bmi <- linelist$wt_kg / (linelist$ht_cm/100)^2
```

However, in this handbook, we emphasize a different approach to defining columns, which uses the function `mutate()` from the **dplyr** package and *piping* with the pipe operator (`%>%`). The syntax is easier to read and there are other advantages explained in the page on \[Cleaning data and core functions\]. You can read more about *piping* in the Piping section below.

```{r, eval=F}
# create new "bmi" column using dplyr syntax
linelist <- linelist %>% 
  mutate(bmi = wt_kg / (ht_cm/100)^2)
```

<!-- ======================================================= -->

### Object structure {.unnumbered}

**Objects can be a single piece of data (e.g. `my_number <- 24`), or they can consist of structured data.**

The graphic below is borrowed from [this online R tutorial](http://venus.ifca.unican.es/Rintro/dataStruct.html). It shows some common data structures and their names. Not included in this image is spatial data, which is discussed in the \[GIS basics\] page.

```{r basics_objects_structures, echo=F, out.width = "75%", out.height="50%", fig.align = "center"}
knitr::include_graphics(here::here("images", "R_data_structures.png"))
```

In epidemiology (and particularly field epidemiology), you will *most commonly* encounter data frames and vectors:

+------------------+--------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+
| Common structure | Explanation                                                                                      | Example                                                                             |
+==================+==================================================================================================+=====================================================================================+
| Vectors          | A container for a sequence of singular objects, all of the same class (e.g. numeric, character). | **"Variables" (columns) in data frames are vectors** (e.g. the column `age_years`). |
+------------------+--------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+
| Data Frames      | Vectors (e.g. columns) that are bound together that all have the same number of rows.            | `linelist` is a data frame.                                                         |
+------------------+--------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+

Note that to create a vector that "stands alone" (is not part of a data frame) the function `c()` is used to combine the different elements. For example, if creating a vector of colors plot's color scale: `vector_of_colors <- c("blue", "red2", "orange", "grey")`

<!-- ======================================================= -->

### Object classes {.unnumbered}

All the objects stored in R have a *class* which tells R how to handle the object. There are many possible classes, but common ones include:

+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| Class      | Explanation                                                                                                                                                                             | Examples                                                                                              |
+============+=========================================================================================================================================================================================+=======================================================================================================+
| Character  | These are text/words/sentences **"within quotation marks"**. Math cannot be done on these objects.                                                                                      | "Character objects are in quotation marks"                                                            |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| Integer    | Numbers that are **whole only** (no decimals)                                                                                                                                           | -5, 14, or 2000                                                                                       |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| Numeric    | These are numbers and **can include decimals**. If within quotation marks they will be considered character class.                                                                      | 23.1 or 14                                                                                            |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| Factor     | These are vectors that have a **specified order** or hierarchy of values                                                                                                                | An variable of economic status with ordered values                                                    |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| Date       | **Once R is told that certain data are Dates**, these data can be manipulated and displayed in special ways. See the page on \[Working with dates\] for more information.               | 2018-04-12 or 15/3/1954 or Wed 4 Jan 1980                                                             |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| Logical    | Values must be one of the two special values TRUE or FALSE (note these are **not** "TRUE" and "FALSE" in quotation marks)                                                               | TRUE or FALSE                                                                                         |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| data.frame | A data frame is how R stores a **typical dataset**. It consists of vectors (columns) of data bound together, that all have the same number of observations (rows).                      | The example AJS dataset named `linelist_raw` contains 68 variables with 300 observations (rows) each. |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| tibble     | tibbles are a variation on data frame, the main operational difference being that they print more nicely to the console (display first 10 rows and only columns that fit on the screen) | Any data frame, list, or matrix can be converted to a tibble with `as_tibble()`                       |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+
| list       | A list is like vector, but holds other objects that can be other different classes                                                                                                      | A list could hold a single number, and a dataframe, and a vector, and even another list within it!    |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+

**You can test the class of an object by providing its name to the function `class()`**. Note: you can reference a specific column within a dataset using the `$` notation to separate the name of the dataset and the name of the column.

```{r, echo=TRUE,}
class(linelist)         # class should be a data frame or tibble

class(linelist$age)     # class should be numeric

class(linelist$gender)  # class should be character
```

Sometimes, a column will be converted to a different class automatically by R. Watch out for this! For example, if you have a vector or column of numbers, but a character value is inserted... the entire column will change to class character.

```{r}
num_vector <- c(1,2,3,4,5) # define vector as all numbers
class(num_vector)          # vector is numeric class
num_vector[3] <- "three"   # convert the third element to a character
class(num_vector)          # vector is now character class
```

One common example of this is when manipulating a data frame in order to print a table - if you make a total row and try to paste/glue together percents in the same cell as numbers (e.g. `23 (40%)`), the entire numeric column above will convert to character and can no longer be used for mathematical calculations.**Sometimes, you will need to convert objects or columns to another class.**

+------------------+---------------------------------------------------------------------------------------+
| Function         | Action                                                                                |
+==================+=======================================================================================+
| `as.character()` | Converts to character class                                                           |
+------------------+---------------------------------------------------------------------------------------+
| `as.numeric()`   | Converts to numeric class                                                             |
+------------------+---------------------------------------------------------------------------------------+
| `as.integer()`   | Converts to integer class                                                             |
+------------------+---------------------------------------------------------------------------------------+
| `as.Date()`      | Converts to Date class - Note: see section on [dates](#dates) for details             |
+------------------+---------------------------------------------------------------------------------------+
| `factor()`       | Converts to factor - Note: re-defining order of value levels requires extra arguments |
+------------------+---------------------------------------------------------------------------------------+

Likewise, there are **base** R functions to check whether an object IS of a specific class, such as `is.numeric()`, `is.character()`, `is.double()`, `is.factor()`, `is.integer()`

Here is [more online material on classes and data structures in R](https://swcarpentry.github.io/r-novice-inflammation/13-supp-data-structures/).

<!-- ======================================================= -->

### Columns/Variables (`$`) {.unnumbered}

**A column in a data frame is technically a "vector" (see table above)** - a series of values that must all be the same class (either character, numeric, logical, etc).

A vector can exist independent of a data frame, for example a vector of column names that you want to include as explanatory variables in a model. To create a "stand alone" vector, use the `c()` function as below:

```{r, warning=F, message=F}
# define the stand-alone vector of character values
explanatory_vars <- c("gender", "fever", "chills", "cough", "aches", "vomit")

# print the values in this named vector
explanatory_vars
```

**Columns in a data frame are also vectors and can be called, referenced, extracted, or created using the `$` symbol.** The `$` symbol connects the name of the column to the name of its data frame. In this handbook, we try to use the word "column" instead of "variable".

```{r basics_objects_call, eval=F}
# Retrieve the length of the vector age_years
length(linelist$age) # (age is a column in the linelist data frame)

```

By typing the name of the dataframe followed by `$` you will also see a drop-down menu of all columns in the data frame. You can scroll through them using your arrow key, select one with your Enter key, and avoid spelling mistakes!

```{r echo=F, out.width = "100%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Calling_Names.gif"))
```

[***ADVANCED TIP:*** Some more complex objects (e.g. a list, or an `epicontacts` object) may have multiple levels which can be accessed through multiple dollar signs. For example `epicontacts$linelist$date_onset`]{style="color: darkgreen;"}

<!-- ======================================================= -->

### Access/index with brackets (`[ ]`) {.unnumbered}

You may need to view parts of objects, also called "indexing", which is often done using the square brackets `[ ]`. Using `$` on a dataframe to access a column is also a type of indexing.

```{r}
my_vector <- c("a", "b", "c", "d", "e", "f")  # define the vector
my_vector[5]                                  # print the 5th element
```

Square brackets also work to return specific parts of an returned output, such as the output of a `summary()` function:

```{r}
# All of the summary
summary(linelist$age)

# Just the second element of the summary, with name (using only single brackets)
summary(linelist$age)[2]

# Just the second element, without name (using double brackets)
summary(linelist$age)[[2]]

# Extract an element by name, without showing the name
summary(linelist$age)[["Median"]]

```

Brackets also work on data frames to view specific rows and columns. You can do this using the syntax `dataframe[rows, columns]`:

```{r basics_objects_access, eval=F}
# View a specific row (2) from dataset, with all columns (don't forget the comma!)
linelist[2,]

# View all rows, but just one column
linelist[, "date_onset"]

# View values from row 2 and columns 5 through 10
linelist[2, 5:10] 

# View values from row 2 and columns 5 through 10 and 18
linelist[2, c(5:10, 18)] 

# View rows 2 through 20, and specific columns
linelist[2:20, c("date_onset", "outcome", "age")]

# View rows and columns based on criteria
# *** Note the dataframe must still be named in the criteria!
linelist[linelist$age > 25 , c("date_onset", "outcome", "age")]

# Use View() to see the outputs in the RStudio Viewer pane (easier to read) 
# *** Note the capital "V" in View() function
View(linelist[2:20, "date_onset"])

# Save as a new object
new_table <- linelist[2:20, c("date_onset")] 
```

Note that you can also achieve the above row/column indexing on data frames and tibbles using **dplyr** syntax (functions `filter()` for rows, and `select()` for columns). Read more about these core functions in the \[Cleaning data and core functions\] page.

To filter based on "row number", you can use the **dplyr** function `row_number()` with open parentheses as part of a logical filtering statement. Often you will use the `%in%` operator and a range of numbers as part of that logical statement, as shown below. To see the *first* N rows, you can also use the special **dplyr** function `head()`.

```{r, eval=F}
# View first 100 rows
linelist %>% head(100)

# Show row 5 only
linelist %>% filter(row_number() == 5)

# View rows 2 through 20, and three specific columns (note no quotes necessary on column names)
linelist %>% filter(row_number() %in% 2:20) %>% select(date_onset, outcome, age)
```

When indexing an object of class **list**, single brackets always return with class list, even if only a single object is returned. Double brackets, however, can be used to access a single element and return a different class than list.\
Brackets can also be written after one another, as demonstrated below.

This [visual explanation of lists indexing, with pepper shakers](https://r4ds.had.co.nz/vectors.html#lists-of-condiments) is humorous and helpful.

```{r}
# define demo list
my_list <- list(
  # First element in the list is a character vector
  hospitals = c("Central", "Empire", "Santa Anna"),
  
  # second element in the list is a data frame of addresses
  addresses   = data.frame(
    street = c("145 Medical Way", "1048 Brown Ave", "999 El Camino"),
    city   = c("Andover", "Hamilton", "El Paso")
    )
  )
```

Here is how the list looks when printed to the console. See how there are two named elements:

-   `hospitals`, a character vector\
-   `addresses`, a data frame of addresses

```{r}
my_list
```

Now we extract, using various methods:

```{r}
my_list[1] # this returns the element in class "list" - the element name is still displayed

my_list[[1]] # this returns only the (unnamed) character vector

my_list[["hospitals"]] # you can also index by name of the list element

my_list[[1]][3] # this returns the third element of the "hospitals" character vector

my_list[[2]][1] # This returns the first column ("street") of the address data frame

```

<!-- ======================================================= -->

### Remove objects {.unnumbered}

You can remove individual objects from your R environment by putting the name in the `rm()` function (no quote marks):

```{r, eval=F}
rm(object_name)
```

You can remove all objects (clear your workspace) by running:

```{r, eval=F}
rm(list = ls(all = TRUE))
```

<!-- ======================================================= -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Piping (`%>%`)

**Two general approaches to working with objects are:**

1)  **Pipes/tidyverse** - pipes send an object from function to function - emphasis is on the *action*, not the object\
2)  **Define intermediate objects** - an object is re-defined again and again - emphasis is on the object

<!-- ======================================================= -->

### **Pipes** {.unnumbered}

**Simply explained, the pipe operator (`%>%`) passes an intermediate output from one function to the next.**\
You can think of it as saying "then". Many functions can be linked together with `%>%`.

-   **Piping emphasizes a sequence of actions, not the object the actions are being performed on**\
-   Pipes are best when a sequence of actions must be performed on one object\
-   Pipes come from the package **magrittr**, which is automatically included in packages **dplyr** and **tidyverse**
-   Pipes can make code more clean and easier to read, more intuitive

Read more on this approach in the tidyverse [style guide](https://style.tidyverse.org/pipes.html)

Here is a fake example for comparison, using fictional functions to "bake a cake". First, the pipe method:

```{r piping_example_pipe, eval=F}
# A fake example of how to bake a cake using piping syntax

cake <- flour %>%       # to define cake, start with flour, and then...
  add(eggs) %>%   # add eggs
  add(oil) %>%    # add oil
  add(water) %>%  # add water
  mix_together(         # mix together
    utensil = spoon,
    minutes = 2) %>%    
  bake(degrees = 350,   # bake
       system = "fahrenheit",
       minutes = 35) %>%  
  let_cool()            # let it cool down
```

Here is another [link](https://cfss.uchicago.edu/notes/pipes/#:~:text=Pipes%20are%20an%20extremely%20useful,code%20and%20combine%20multiple%20operations) describing the utility of pipes.

Piping is not a **base** function. To use piping, the **magrittr** package must be installed and loaded (this is typically done by loading **tidyverse** or **dplyr** package which include it). You can [read more about piping in the magrittr documentation](https://magrittr.tidyverse.org/).

Note that just like other R commands, pipes can be used to just display the result, or to save/re-save an object, depending on whether the assignment operator `<-` is involved. See both below:

```{r, eval=F}
# Create or overwrite object, defining as aggregate counts by age category (not printed)
linelist_summary <- linelist %>% 
  count(age_cat)
```

```{r}
# Print the table of counts in the console, but don't save it
linelist %>% 
  count(age_cat)
```

**`%<>%`**\
This is an "assignment pipe" from the **magrittr** package, which *pipes an object forward and also re-defines the object*. It must be the first pipe operator in the chain. It is shorthand. The below two commands are equivalent:

```{r, eval=F}
linelist <- linelist %>%
  filter(age > 50)

linelist %<>% filter(age > 50)
```

<!-- ======================================================= -->

### Define intermediate objects {.unnumbered}

This approach to changing objects/dataframes may be better if:

-   You need to manipulate multiple objects\
-   There are intermediate steps that are meaningful and deserve separate object names

**Risks:**

-   Creating new objects for each step means creating lots of objects. If you use the wrong one you might not realize it!\
-   Naming all the objects can be confusing\
-   Errors may not be easily detectable

Either name each intermediate object, or overwrite the original, or combine all the functions together. All come with their own risks.

Below is the same fake "cake" example as above, but using this style:

```{r piping_example_redefine, eval=F}
# a fake example of how to bake a cake using this method (defining intermediate objects)
batter_1 <- left_join(flour, eggs)
batter_2 <- left_join(batter_1, oil)
batter_3 <- left_join(batter_2, water)

batter_4 <- mix_together(object = batter_3, utensil = spoon, minutes = 2)

cake <- bake(batter_4, degrees = 350, system = "fahrenheit", minutes = 35)

cake <- let_cool(cake)
```

Combine all functions together - this is difficult to read:

```{r eval=F}
# an example of combining/nesting mutliple functions together - difficult to read
cake <- let_cool(bake(mix_together(batter_3, utensil = spoon, minutes = 2), degrees = 350, system = "fahrenheit", minutes = 35))
```

<!-- ======================================================= -->

## Key operators and functions {#operators}

This section details operators in R, such as:

-   Definitional operators\
-   Relational operators (less than, equal too..)\
-   Logical operators (and, or...)\
-   Handling missing values\
-   Mathematical operators and functions (+/-, >, sum(), median(), ...)\
-   The `%in%` operator

<!-- ======================================================= -->

### Assignment operators {.unnumbered}

**`<-`**

The basic assignment operator in R is `<-`. Such that `object_name <- value`.\
This assignment operator can also be written as `=`. We advise use of `<-` for general R use.\
We also advise surrounding such operators with spaces, for readability.

**`<<-`**

If [Kuandika Kazi], or using R in an interactive way with sourced scripts, then you may need to use this assignment operator `<<-` (from **base** R). This operator is used to define an object in a higher 'parent' R Environment. See this [online reference](https://stat.ethz.ch/R-manual/R-devel/library/base/html/assignOps.html).

**`%<>%`**

This is an "assignment pipe" from the **magrittr** package, which pipes an object forward and *also re-defines the object*. It must be the first pipe operator in the chain. It is shorthand, as shown below in two equivalent examples:

```{r, eval=F}
linelist <- linelist %>% 
  mutate(age_months = age_years * 12)
```

The above is equivalent to the below:

```{r, eval=F}
linelist %<>% mutate(age_months = age_years * 12)
```

**`%<+%`**

This is used to add data to phylogenetic trees with the **ggtree** package. See the page on \[Phylogenetic trees\] or this online [resource book](https://yulab-smu.top/treedata-book/).

<!-- ======================================================= -->

### Relational and logical operators {.unnumbered}

Relational operators compare values and are often used when defining new variables and subsets of datasets. Here are the common relational operators in R:

+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Meaning                  | Operator   | Example      | Example Result                                                                                                                                         |
+==========================+============+==============+========================================================================================================================================================+
| Equal to                 | `==`       | `"A" == "a"` | `FALSE` (because R is case sensitive) *Note that == (double equals) is different from = (single equals), which acts like the assignment operator `<-`* |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Not equal to             | `!=`       | `2 != 0`     | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Greater than             | `>`        | `4 > 2`      | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Less than                | `<`        | `4 < 2`      | `FALSE`                                                                                                                                                |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Greater than or equal to | `>=`       | `6 >= 4`     | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Less than or equal to    | `<=`       | `6 <= 4`     | `FALSE`                                                                                                                                                |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Value is missing         | `is.na()`  | `is.na(7)`   | `FALSE` (see page on \[Missing data\])                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+
| Value is not missing     | `!is.na()` | `!is.na(7)`  | `TRUE`                                                                                                                                                 |
+--------------------------+------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+

Logical operators, such as AND and OR, are often used to connect relational operators and create more complicated criteria. Complex statements might require parentheses ( ) for grouping and order of application.

+-------------+-----------------------------------------------------------------------+
| Meaning     | Operator                                                              |
+=============+=======================================================================+
| AND         | `&`                                                                   |
+-------------+-----------------------------------------------------------------------+
| OR          | `|` (vertical bar)                                                    |
+-------------+-----------------------------------------------------------------------+
| Parentheses | `( )` Used to group criteria together and clarify order of operations |
+-------------+-----------------------------------------------------------------------+

For example, below, we have a linelist with two variables we want to use to create our case definition, `hep_e_rdt`, a test result and `other_cases_in_hh`, which will tell us if there are other cases in the household. The command below uses the function `case_when()` to create the new variable `case_def` such that:

```{r eval=FALSE}
linelist_cleaned <- linelist %>%
  mutate(case_def = case_when(
    is.na(rdt_result) & is.na(other_case_in_home)            ~ NA_character_,
    rdt_result == "Positive"                                 ~ "Confirmed",
    rdt_result != "Positive" & other_cases_in_home == "Yes"  ~ "Probable",
    TRUE                                                     ~ "Suspected"
  ))
```

+------------------------------------------------------------------------------------------------+--------------------------------------------+
| Criteria in example above                                                                      | Resulting value in new variable "case_def" |
+================================================================================================+============================================+
| If the value for variables `rdt_result` and `other_cases_in_home` are missing                  | `NA` (missing)                             |
+------------------------------------------------------------------------------------------------+--------------------------------------------+
| If the value in `rdt_result` is "Positive"                                                     | "Confirmed"                                |
+------------------------------------------------------------------------------------------------+--------------------------------------------+
| If the value in `rdt_result` is NOT "Positive" AND the value in `other_cases_in_home` is "Yes" | "Probable"                                 |
+------------------------------------------------------------------------------------------------+--------------------------------------------+
| If one of the above criteria are not met                                                       | "Suspected"                                |
+------------------------------------------------------------------------------------------------+--------------------------------------------+

*Note that R is case-sensitive, so "Positive" is different than "positive"...*

<!-- ======================================================= -->

### Missing values {.unnumbered}

In R, missing values are represented by the special value `NA` (a "reserved" value) (capital letters N and A - not in quotation marks). If you import data that records missing data in another way (e.g. 99, "Missing", or .), you may want to re-code those values to `NA`. How to do this is addressed in the \[Import and export\] page.

**To test whether a value is `NA`, use the special function `is.na()`**, which returns `TRUE` or `FALSE`.

```{r basics_operators_missing}
rdt_result <- c("Positive", "Suspected", "Positive", NA)   # two positive cases, one suspected, and one unknown
is.na(rdt_result)  # Tests whether the value of rdt_result is NA
```

Read more about missing, infinite, `NULL`, and impossible values in the page on \[Missing data\]. Learn how to convert missing values when importing data in the page on \[Import and export\].

<!-- ======================================================= -->

### Mathematics and statistics {.unnumbered}

All the operators and functions in this page are automatically available using **base** R.

#### Mathematical operators {.unnumbered}

These are often used to perform addition, division, to create new columns, etc. Below are common mathematical operators in R. Whether you put spaces around the operators is not important.

| Purpose             | Example in R |
|---------------------|--------------|
| addition            | 2 + 3        |
| subtraction         | 2 - 3        |
| multiplication      | 2 \* 3       |
| division            | 30 / 5       |
| exponent            | 2\^3         |
| order of operations | ( )          |

#### Mathematical functions {.unnumbered}

| Purpose            | Function                              |
|--------------------|---------------------------------------|
| rounding           | round(x, digits = n)                  |
| rounding           | janitor::round_half_up(x, digits = n) |
| ceiling (round up) | ceiling(x)                            |
| floor (round down) | floor(x)                              |
| absolute value     | abs(x)                                |
| square root        | sqrt(x)                               |
| exponent           | exponent(x)                           |
| natural logarithm  | log(x)                                |
| log base 10        | log10(x)                              |
| log base 2         | log2(x)                               |

Note: for `round()` the `digits =` specifies the number of decimal placed. Use `signif()` to round to a number of significant figures.

#### Scientific notation {.unnumbered}

The likelihood of scientific notation being used depends on the value of the `scipen` option.

From the documentation of `?options`: scipen is a penalty to be applied when deciding to print numeric values in fixed or exponential notation. Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than 'scipen' digits wider.

If it is set to a low number (e.g. 0) it will be "turned on" always. To "turn off" scientific notation in your R session, set it to a very high number, for example:

```{r, eval=F}
# turn off scientific notation
options(scipen=999)
```

#### Rounding {.unnumbered}

[***DANGER:*** `round()` uses "banker's rounding" which rounds up from a .5 only if the upper number is even. Use `round_half_up()` from **janitor** to consistently round halves up to the nearest whole number. See [this explanation](https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#explore-records-with-duplicated-values-for-specific-combinations-of-variables-with-get_dupes)]{style="color: red;"}

```{r}
# use the appropriate rounding function for your work
round(c(2.5, 3.5))

janitor::round_half_up(c(2.5, 3.5))
```

#### Statistical functions {.unnumbered}

[***CAUTION:*** The functions below will by default include missing values in calculations. Missing values will result in an output of `NA`, unless the argument `na.rm = TRUE` is specified. This can be written shorthand as `na.rm = T`.]{style="color: orange;"}

| Objective               | Function           |
|-------------------------|--------------------|
| mean (average)          | mean(x, na.rm=T)   |
| median                  | median(x, na.rm=T) |
| standard deviation      | sd(x, na.rm=T)     |
| quantiles\*             | quantile(x, probs) |
| sum                     | sum(x, na.rm=T)    |
| minimum value           | min(x, na.rm=T)    |
| maximum value           | max(x, na.rm=T)    |
| range of numeric values | range(x, na.rm=T)  |
| summary\*\*             | summary(x)         |

Notes:

-   `*quantile()`: `x` is the numeric vector to examine, and `probs =` is a numeric vector with probabilities within 0 and 1.0, e.g `c(0.5, 0.8, 0.85)`
-   `**summary()`: gives a summary on a numeric vector including mean, median, and common percentiles

[***DANGER:*** If providing a vector of numbers to one of the above functions, be sure to wrap the numbers within `c()` .]{style="color: red;"}

```{r}
# If supplying raw numbers to a function, wrap them in c()
mean(1, 6, 12, 10, 5, 0)    # !!! INCORRECT !!!  

mean(c(1, 6, 12, 10, 5, 0)) # CORRECT
```

#### Other useful functions {.unnumbered}

+----------------------------+-------------------+-------------------------------------------------+
| Objective                  | Function          | Example                                         |
+============================+===================+=================================================+
| create a sequence          | seq(from, to, by) | `seq(1, 10, 2)`                                 |
+----------------------------+-------------------+-------------------------------------------------+
| repeat x, n times          | rep(x, ntimes)    | `rep(1:3, 2)` or `rep(c("a", "b", "c"), 3)`     |
+----------------------------+-------------------+-------------------------------------------------+
| subdivide a numeric vector | cut(x, n)         | `cut(linelist$age, 5)`                          |
+----------------------------+-------------------+-------------------------------------------------+
| take a random sample       | sample(x, size)   | `sample(linelist$id, size = 5, replace = TRUE)` |
+----------------------------+-------------------+-------------------------------------------------+

<!-- ======================================================= -->

### `%in%` {.unnumbered}

A very useful operator for matching values, and for quickly assessing if a value is within a vector or dataframe.

```{r}
my_vector <- c("a", "b", "c", "d")
```

```{r}
"a" %in% my_vector
"h" %in% my_vector
```

To ask if a value is **not** `%in%` a vector, put an exclamation mark (!) **in front** of the logic statement:

```{r}
# to negate, put an exclamation in front
!"a" %in% my_vector
!"h" %in% my_vector
```

`%in%` is very useful when using the **dplyr** function `case_when()`. You can define a vector previously, and then reference it later. For example:

```{r eval=F}
affirmative <- c("1", "Yes", "YES", "yes", "y", "Y", "oui", "Oui", "Si")

linelist <- linelist %>% 
  mutate(child_hospitaled = case_when(
    hospitalized %in% affirmative & age < 18 ~ "Hospitalized Child",
    TRUE                                      ~ "Not"))
```

Note: If you want to detect a partial string, perhaps using `str_detect()` from **stringr**, it will not accept a character vector like `c("1", "Yes", "yes", "y")`. Instead, it must be given a *regular expression* - one condensed string with OR bars, such as "1\|Yes\|yes\|y". For example, `str_detect(hospitalized, "1|Yes|yes|y")`. See the page on \[Characters and strings\] for more information.

You can convert a character vector to a named regular expression with this command:

```{r}
affirmative <- c("1", "Yes", "YES", "yes", "y", "Y", "oui", "Oui", "Si")
affirmative

# condense to 
affirmative_str_search <- paste0(affirmative, collapse = "|")  # option with base R
affirmative_str_search <- str_c(affirmative, collapse = "|")   # option with stringr package

affirmative_str_search
```

<!-- ======================================================= -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Errors & warnings

This section explains:

-   The difference between errors and warnings\
-   General syntax tips for writing R code\
-   Code assists

Common errors and warnings and troubleshooting tips can be found in the page on \[Errors and help\].

<!-- ======================================================= -->

### Error versus Warning {.unnumbered}

When a command is run, the R Console may show you warning or error messages in red text.

-   A **warning** means that R has completed your command, but had to take additional steps or produced unusual output that you should be aware of.

-   An **error** means that R was not able to complete your command.

Look for clues:

-   The error/warning message will often include a line number for the problem.

-   If an object "is unknown" or "not found", perhaps you spelled it incorrectly, forgot to call a package with library(), or forgot to re-run your script after making changes.

If all else fails, copy the error message into Google along with some key terms - chances are that someone else has worked through this already!

<!-- ======================================================= -->

### General syntax tips {.unnumbered}

A few things to remember when writing commands in R, to avoid errors and warnings:

-   Always close parentheses - tip: count the number of opening "(" and closing parentheses ")" for each code chunk
-   Avoid spaces in column and object names. Use underscore ( \_ ) or periods ( . ) instead
-   Keep track of and remember to separate a function's arguments with commas
-   R is case-sensitive, meaning `Variable_A` is *different* from `variable_A`

<!-- ======================================================= -->

### Code assists {.unnumbered}

Any script (RMarkdown or otherwise) will give clues when you have made a mistake. For example, if you forgot to write a comma where it is needed, or to close a parentheses, RStudio will raise a flag on that line, on the right side of the script, to warn you.
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/basics.Rmd-->


# Transition to R { }  

Placeholder


## From Excel  
### Benefits {.unnumbered}  
### Tidy data {.unnumbered}  
### Functions {.unnumbered}  
### Scripts {.unnumbered}  
### Excel-to-R resources {.unnumbered}
### R-Excel interaction {.unnumbered}  
## From Stata  
## From SAS  
## Data interoperability  

<!--chapter:end:new_pages/transition_to_R.Rmd-->


# Suggested packages

Placeholder


## Packages from CRAN  
## Packages from Github  

<!--chapter:end:new_pages/packages_suggested.Rmd-->


# R projects {}  

Placeholder


## Suggested use  
## Creating an R project {}
### Switch projects {.unnumbered}
### Settings {.unnumbered}  
### Organization {.unnumbered}  
### Version control {.unnumbered}  
## Examples  
## Resources {}

<!--chapter:end:new_pages/r_projects.Rmd-->


# Import and export {}

Placeholder


## Overview
## The **rio** package {}  
## The **here** package {#here}
## File paths  
### "Relative" file paths {.unnumbered}
### "Absolute" file paths {.unnumbered}  
### Select file manually {.unnumbered}
## Import data  
### Specific Excel sheets {.unnumbered}
### Missing values {#import_missing .unnumbered} 
### Skip rows {.unnumbered} 
### Manage a second header row {.unnumbered}  
#### Remove the second header row {.unnumbered}  
#### Make a data dictionary {.unnumbered}  
#### Combine the two header rows {.unnumbered}  
### Google sheets {.unnumbered}
## Multiple files - import, export, split, combine  
## Import from Github {#import_github}
### CSV files {.unnumbered}  
### XLSX files {.unnumbered}  
### Shapefiles {.unnumbered} 
## Manual data entry {}
### Entry by rows {.unnumbered}  
### Entry by columns {.unnumbered}  
### Pasting from clipboard {.unnumbered}  
## Import most recent file  
### Dates in file name {.unnumbered}  
### Use the file info {.unnumbered}  
## APIs {#import_api}
### HTTP request {.unnumbered}  
### Packages {.unnumbered}  
### Publicly-available data {.unnumbered}  
### Authentication required {.unnumbered}  
## Export {}  
### With **rio** package {.unnumbered}
### To clipboard {.unnumbered}
## RDS files {#import_rds}
## Rdata files and lists {#import_rdata}
## Saving plots {} 
## Resources {} 

<!--chapter:end:new_pages/importing.Rmd-->

# (PART) Data Management {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_data_management.Rmd-->


# Cleaning data and core functions {}

Placeholder


### Core functions {.unnumbered}  
### Nomenclature {.unnumbered}  
## Cleaning pipeline
## Load packages  
## Import data  
### Import {.unnumbered}  
### Review {.unnumbered}  
## Column names {} 
### Automatic cleaning {.unnumbered}  
### Manual name cleaning {.unnumbered}  
#### Rename by column position {.unnumbered} 
#### Rename via `select()` and `summarise()` {.unnumbered}  
### Other challenges {.unnumbered}  
#### Empty Excel column names {.unnumbered} 
#### Merged Excel column names and cells {.unnumbered}  
## Select or re-order columns {} 
### Keep columns {.unnumbered}  
### "tidyselect" helper functions {#clean_tidyselect .unnumbered}  
### Remove columns {.unnumbered} 
### Standalone {.unnumbered}
#### Add to the pipe chain {.unnumbered}  
## Deduplication
## Column creation and transformation { }
### New columns {.unnumbered}
### Convert column class {.unnumbered}
### Grouped data {.unnumbered}  
### Transform multiple columns {#clean_across .unnumbered}
#### `across()` column selection {.unnumbered}  
#### `across()` functions {.unnumbered}
### `coalesce()` {.unnumbered}  
### Cumulative math {.unnumbered}
### Using **base** R {.unnumbered}  
### Add to pipe chain {.unnumbered}  
## Re-code values
### Specific values {.unnumbered}  
### By logic {.unnumbered}
### Simple logic {.unnumbered}  
#### `replace()` {.unnumbered}  
#### `ifelse()` and `if_else()` {.unnumbered}  
### Complex logic {#clean_case_when .unnumbered}  
### Missing values {.unnumbered} 
### Cleaning dictionary {.unnumbered}
#### Add to pipe chain {.unnumbered}  
## Numeric categories {#num_cats}
### Review distribution {.unnumbered}
### `age_categories()` {.unnumbered}
### `cut()` {.unnumbered}
### Quantile breaks {.unnumbered}  
### Evenly-sized groups {.unnumbered}  
### `case_when()` { .unnumbered}
### Add to pipe chain {.unnumbered}  
## Add rows  
### One-by-one {.unnumbered}  
### Bind rows {.unnumbered}  
## Filter rows {  }
### Simple filter {.unnumbered} 
### Filter out missing values {.unnumbered}  
### Filter by row number {.unnumbered}  
### Complex filter {.unnumbered} 
#### Examine the data  {.unnumbered}  
#### How filters handle missing numeric and date values {.unnumbered}  
#### Design the filter {.unnumbered}  
### Standalone {.unnumbered}  
### Quickly review records {.unnumbered} 
#### Add to pipe chain {.unnumbered}  
## Row-wise calculations  
## Arrange and sort  

<!--chapter:end:new_pages/cleaning.Rmd-->


# Working with dates {}

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## Current date  
## Convert to Date  
### **base** R {.unnumbered}  
### **lubridate** {.unnumbered}  
### Combine columns {.unnumbered}  
## Excel dates
## Messy dates  
## Working with date-time class  
### Convert dates with times {.unnumbered}  
### Convert times alone {.unnumbered}  
### Extract time {.unnumbered}  
## Working with dates   
### Extract date components {.unnumbered}  
### Date math {.unnumbered}  
### Date intervals {.unnumbered}  
## Date display  
### `format()` {.unnumbered}  
### Month-Year {.unnumbered}  
## Epidemiological weeks {#dates_epi_wks}
### **lubridate** {.unnumbered}  
### Weekly counts {.unnumbered}  
### Epiweek alternatives {.unnumbered}  
## Converting dates/time zones
## Lagging and leading calculations  
## Resources  

<!--chapter:end:new_pages/dates.Rmd-->


# Characters and strings { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data  {.unnumbered}  
## Unite, split, and arrange { }
### Combine strings {.unnumbered}
### Dynamic strings {.unnumbered}
### Unite columns  {#str_unite .unnumbered}
### Split {.unnumbered}  
### Split columns {.unnumbered}  
### Arrange alphabetically {.unnumbered} 
### base R functions {.unnumbered}
## Clean and standardise  
### Change case {.unnumbered}
### Pad length  {#str_pad .unnumbered}
### Truncate {.unnumbered} 
### Standardize length {.unnumbered}
### Remove leading/trailing whitespace {.unnumbered}  
### Remove repeated whitespace within {.unnumbered}  
### Wrap into paragraphs {.unnumbered}  
## Handle by position { }
### Extract by character position {.unnumbered}  
### Extract by word position {.unnumbered} 
### Replace by character position {.unnumbered} 
### Evaluate length  {.unnumbered}
## Patterns { }
### Detect a pattern {.unnumbered}
#### Convert commas to periods {.unnumbered}  
### Replace all {.unnumbered}  
### Detect within logic {.unnumbered}
### Locate pattern position {.unnumbered}  
### Extract a match {.unnumbered}  
### Subset and count {.unnumbered}  
### Regex groups {.unnumbered}
## Special characters  
## Regular expressions (regex) 
## Regex and special characters { } 
## Resources { }

<!--chapter:end:new_pages/characters_strings.Rmd-->


# Factors {}

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
### New categorical variable {#fct_newcat .unnumbered}  
#### Create column {.unnumbered}  
#### Default value order {.unnumbered}  
## Convert to factor  
## Add or drop levels  
### Add {#fct_add .unnumbered}
### Drop {.unnumbered}  
## Adjust level order {#fct_adjust} 
### Manually {.unnumbered} 
### Within a plot {.unnumbered}  
### Reverse {.unnumbered}  
### By frequency {.unnumbered}  
### By appearance {.unnumbered}  
### By summary statistic of another column {.unnumbered}  
### By "end" value {.unnumbered}  
## Missing values {#fct_missing}  
## Combine levels  
### Manually {.unnumbered}  
### Reduce into "Other" {.unnumbered}  
### Reduce by frequency {.unnumbered}
## Show all levels  
### In plots {.unnumbered}  
### In tables {.unnumbered}  
## Epiweeks  
### Epiweeks in a plot {.unnumbered}  
### Epiweeks in the data {.unnumbered}  
## Resources {} 

<!--chapter:end:new_pages/factors.Rmd-->


# Pivoting data {}

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Malaria count data {-}  
### Linelist case data {-}  
## Wide-to-long {}
### "Wide" format {.unnumbered}
### `pivot_longer()` {.unnumbered}
### Standard pivoting {.unnumbered}  
### Pivoting data of multiple classes {.unnumbered}
## Long-to-wide {}
### Data {.unnumbered}
### Pivot wider {.unnumbered}  
## Fill 
### Data {.unnumbered}
### `fill()` {.unnumbered}
## Resources  

<!--chapter:end:new_pages/pivoting.Rmd-->


# Grouping data { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
## Grouping {  }
### Unique groups {.unnumbered}  
### New columns {.unnumbered} 
### Add/drop grouping columns {.unnumbered}  
## Un-group  
## Summarise {#group_summarise} 
## Counts and tallies  
### `tally()` {.unnumbered}  
### `count()`  {.unnumbered}  
### Add counts {.unnumbered}  
### Add totals {.unnumbered} 
## Grouping by date  
### Linelist cases into days  {.unnumbered}  
### Linelist cases into weeks {.unnumbered}  
### Linelist cases into months {.unnumbered}
### Daily counts into weeks {.unnumbered}
#### Daily counts into months {.unnumbered}
## Arranging grouped data
## Filter on grouped data
### `filter()` {.unnumbered}
### Slice rows per group {.unnumbered} 
### Filter on group size {#group_filter_grp_size .unnumbered} 
## Mutate on grouped data  
## Select on grouped data  
## Resources {  }

<!--chapter:end:new_pages/grouping.Rmd-->


# Joining data { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}
### Import data {.unnumbered}
### Example datasets {.unnumbered}
#### "Miniature" case linelist {#joins_llmini .unnumbered}  
#### Hospital information data frame {#joins_hosp_info .unnumbered}  
### Pre-cleaning {.unnumbered}
## **dplyr** joins { }
### General syntax {.unnumbered}
### Left and right joins {.unnumbered}  
#### "Should I use a right join, or a left join?" {.unnumbered}  
### Full join {.unnumbered} 
### Inner join {.unnumbered} 
### Semi join {.unnumbered} 
### Anti join {.unnumbered} 
#### Simple `anti_join()` example {.unnumbered}  
#### Complex `anti_join()` example {.unnumbered}  
## Probabalistic matching { }
### Probabilistic matching {.unnumbered}  
### Probabilistic deduplication {.unnumbered}  
## Binding and aligning  
### Bind rows {.unnumbered}
### Bind columns {.unnumbered}
#### Use `match()` to align ordering {.unnumbered}  
## Resources { }

<!--chapter:end:new_pages/joining_matching.Rmd-->


# De-duplication {}  

Placeholder


## Preparation { }
### Load packages {.unnumbered}
### Import data {.unnumbered}
#### Here is the data frame {#dedup_data .unnumbered}  
## Deduplication { }
### Examine duplicate rows {.unnumbered}  
### Keep only unique rows  {.unnumbered}
### Deduplicate elements in a vector {.unnumbered}  
### Using **base** R {.unnumbered}
## Slicing { }
### Slice with groups  {.unnumbered}
### Keep all but mark them  {.unnumbered}
### Calculate row completeness {.unnumbered} 
## Roll-up values {#str_rollup}
### Roll-up values into one row {.unnumbered}  
### Overwrite values/hierarchy {.unnumbered} 
## Probabilistic de-duplication  
## Resources { }

<!--chapter:end:new_pages/deduplication.Rmd-->


# Iteration, loops, and lists { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## *for loops* {  }
### *for loops* in R {#iter_loops .unnumbered}  
### Core components {.unnumbered}   
### Sequence {.unnumbered}  
### Operations  {.unnumbered}  
### Container {.unnumbered}
### Printing {.unnumbered}  
### Testing your for loop {.unnumbered}
### Looping plots {.unnumbered}
### Tracking progress of a loop {.unnumbered} 
## **purrr** and lists {#iter_purrr}
### Load packages {.unnumbered}  
### `map()` {.unnumbered}  
#### Example - import and combine Excel sheets {#iter_combined .unnumbered}  
### Split dataset and export {.unnumbered}  
#### Split dataset {.unnumbered}  
##### More than one `group_split()` column {.unnumbered}  
#### Export as Excel sheets {.unnumbered}  
#### Export as CSV files {.unnumbered}  
### Custom functions {.unnumbered}  
### Mapping a function across columns {.unnumbered}  
### Extract from lists {.unnumbered}  
#### Names of elements {.unnumbered}  
#### Elements by name or position {.unnumbered}  
#### `pluck()` {.unnumbered}  
### Convert list to data frame {.unnumbered}  
### Discard, keep, and compact lists {.unnumbered}  
### `pmap()` {.unnumbered}
## Apply functions  
## Resources { }

<!--chapter:end:new_pages/iteration.Rmd-->

# (PART) Analysis {.unnumbered}

```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_analysis.Rmd-->


# Descriptive tables { }

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
## Browse data {  }
### **skimr** package {.unnumbered}
### Summary statistics {.unnumbered} 
## **janitor** package {#tbl_janitor}  
### Simple tabyl {.unnumbered}  
### Cross-tabulation {.unnumbered}  
### "Adorning" the tabyl {#tbl_adorn .unnumbered}  
### Printing the tabyl {.unnumbered}
### Use on other tables {.unnumbered}  
### Saving the tabyl {.unnumbered}  
### Statistics {#janitor_age_out_stats .unnumbered}  
### Other tips {.unnumbered}  
## **dplyr** package   
### Get counts {.unnumbered}  
### Show all levels {.unnumbered}  
### Proportions {#tbl_dplyr_prop .unnumbered}  
### Plotting {.unnumbered}  
### Summary statistics {.unnumbered}  
### Conditional statistics {.unnumbered}  
### Glueing together {.unnumbered}  
#### Percentiles {.unnumbered}  
### Summarise aggregated data {.unnumbered}  
### `across()` multiple columns {.unnumbered}  
### Pivot wider {#tbls_pivot_wider .unnumbered}
### Total rows {#tbl_dplyr_totals .unnumbered}  
#### **janitor**'s `adorn_totals()` {.unnumbered}  
#### `summarise()` on "total" data and then `bind_rows()` {.unnumbered}  
## **gtsummary** package {#tbl_gt}   
### Summary table {.unnumbered}
### Adjustments {.unnumbered}  
### Multi-line stats for continuous variables {.unnumbered}  
## **base** R   
### Proportions {.unnumbered}  
### Totals {.unnumbered}  
### Convert to data frame {.unnumbered}  
## Resources {  }

<!--chapter:end:new_pages/tables_descriptive.Rmd-->


# Simple statistical tests { }

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
## **base** R {}
### T-tests {.unnumbered} 
### Shapiro-Wilk test {.unnumbered}  
### Wilcoxon rank sum test {.unnumbered}
### Kruskal-Wallis test {.unnumbered}
### Chi-squared test {.unnumbered} 
## **rstatix** package {}
### Summary statistics {.unnumbered}  
### T-test {.unnumbered}  
### Shapiro-Wilk test {.unnumbered}  
### Wilcoxon rank sum test {.unnumbered}  
### Kruskal-Wallis test {.unnumbered}  
### Chi-squared test {.unnumbered}  
## `gtsummary` package {#stats_gt}
### Chi-squared test {.unnumbered}
### T-tests {.unnumbered} 
### Wilcoxon rank sum test{.unnumbered}
### Kruskal-wallis test {.unnumbered}
## Correlations 
## Resources {  }

<!--chapter:end:new_pages/stat_tests.Rmd-->


# Univariate and multivariable regression { }

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
### Clean data {.unnumbered}
#### Store explanatory variables {.unnumbered}  
#### Convert to 1's and 0's  {.unnumbered}   
#### Drop rows with missing values {.unnumbered}  
## Univariate {  }
### **base** R {.unnumbered}
#### Linear regression {.unnumbered}  
#### Logistic regression {.unnumbered}  
#### Univariate `glm()` {.unnumbered}
#### Printing results {.unnumbered}
#### Looping multiple univariate models {.unnumbered}  
### **gtsummary** package {#reg_gt_uni .unnumbered}
## Stratified {  }
## Multivariable  
### Conduct multivariable {.unnumbered}  
#### Building the model {.unnumbered}  
### Combine univariate and multivariable {.unnumbered}
#### Combine with **gtsummary**  {.unnumbered}  
#### Combine with **dplyr** {.unnumbered}  
## Forest plot {  }
### **ggplot2** package {.unnumbered}
### **easystats** packages {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/regression.Rmd-->


# Missing data { }

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Convert missing on import {.unnumbered}  
## Missing values in R { }
### `NA` {.unnumbered}  
### Versions of `NA` {.unnumbered}  
### `NULL` {.unnumbered}  
### `NaN` {.unnumbered}  
### `Inf` {.unnumbered}  
### Examples {.unnumbered}  
## Useful functions { }
### `is.na()` and `!is.na()` {.unnumbered}  
### `na.omit()` {.unnumbered}  
### `drop_na()` {.unnumbered}  
### `na.rm = TRUE` {.unnumbered}  
## Assess missingness in a data frame { }
### Quantifying missingness {.unnumbered}
### Visualizing missingness {.unnumbered}  
### Explore and visualize missingness relationships {.unnumbered} 
### "Shadow" columns {.unnumbered}
## Using data with missing values  
### Filter out rows with missing values {.unnumbered}
### Handling `NA` in `ggplot()` {.unnumbered}
### `NA` in factors {.unnumbered}
## Imputation { }
### Types of missing data {.unnumbered}
### Useful packages {.unnumbered}
### Mean Imputation {.unnumbered}
### Regression imputation {.unnumbered}
### LOCF and BOCF {.unnumbered}
### Multiple Imputation {.unnumbered}
## Resources { }

<!--chapter:end:new_pages/missing_data.Rmd-->


# Standardised rates { }  

Placeholder


## Overview  
## Preparation {  }
### Load packages {.unnumbered}
### Load population data {.unnumbered}  
### Load death counts {.unnumbered}  
### Clean populations and deaths {.unnumbered}  
### Load reference population {.unnumbered}  
### Clean reference population {.unnumbered}
### Create dataset with standard population {#standard_all .unnumbered}  
## **dsr** package {  }
### Standardized rates {.unnumbered}
### Standardized rate ratios {.unnumbered}
### Standardized rate difference {.unnumbered}
## **PHEindicatormethods** package {#standard_phe  }
### Directly standardized rates {.unnumbered}
### Indirectly standardized rates {#standard_indirect .unnumbered}
## Resources {  }

<!--chapter:end:new_pages/standardization.Rmd-->


# Moving averages { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
## Calculate with **slider** {  }
### Rolling by date  {#roll_index .unnumbered}  
### Indexed data {.unnumbered}  
### Rolling by group {#roll_slider_group .unnumbered}  
## Calculate with **tidyquant** within `ggplot()` {  }
## Resources {  }

<!--chapter:end:new_pages/moving_average.Rmd-->


# Time series and outbreak detection { }  

Placeholder


## Overview {  }
## Preparation {  }
### Packages {.unnumbered}
### Load data {.unnumbered}
### Clean data {.unnumbered}
### Download climate data {.unnumbered} 
### Load climate data {.unnumbered}
## Time series data {  }
### Duplicates {.unnumbered}
### Missings {.unnumbered}
## Descriptive analysis {  }
### Moving averages {#timeseries_moving .unnumbered}
### Periodicity {.unnumbered}
### Decomposition {.unnumbered}
### Autocorrelation {.unnumbered}
## Fitting regressions {  }
### Fourier terms {.unnumbered}
### Negative binomial {.unnumbered}
### Residuals {.unnumbered}
## Relation of two time series {  }
### Merging datasets {.unnumbered}
### Descriptive analysis {.unnumbered}
### Lags and cross-correlation {.unnumbered}
### Negative binomial with two variables {.unnumbered}
#### Residuals {.unnumbered}
## Outbreak detection {  }
### **trending** package {.unnumbered}
#### Cut-off date { -}
#### Add rows {.unnumbered}
#### Fourier terms {.unnumbered}
#### Split data and fit regression {.unnumbered}
#### Prediction validation {.unnumbered}
### **surveillance** package {.unnumbered}
#### Farrington method {.unnumbered}
#### GLRNB method {.unnumbered}
## Interrupted timeseries {  }
## Resources {  }

<!--chapter:end:new_pages/time_series.Rmd-->


# Epidemic modeling { }  

Placeholder


## Overview {  }
## Preparation {  }
## Estimating R<sub>t</sub> {  }
### EpiNow2 vs. EpiEstim {.unnumbered}
### EpiNow2 {.unnumbered}
#### Estimating delay distributions {.unnumbered}
#### Running **EpiNow2** {.unnumbered}
#### Analysing outputs {.unnumbered}
### EpiEstim {.unnumbered}
#### Using serial interval estimates from the literature {.unnumbered}
#### Using serial interval estimates from the data {.unnumbered}
#### Specifying estimation time windows {.unnumbered}
#### Analysing outputs {.unnumbered}
## Projecting incidence {  }
### EpiNow2 {.unnumbered}
### projections {.unnumbered}
#### Using serial interval estimates from the literature {.unnumbered}
#### Using serial interval estimates from the data {.unnumbered}
#### Projecting incidence {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/epidemic_models.Rmd-->


# Contact tracing { }

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}
#### Case data {.unnumbered}  
#### Contacts data {.unnumbered}  
#### Follow-up data {.unnumbered}  
#### Relationships data {.unnumbered}  
## Descriptive analyses  
### Demographics {.unnumbered}  
#### Age and Gender of contacts {.unnumbered}  
### Contacts per case {.unnumbered}  
## Contact Follow Up  
### Data cleaning {.unnumbered}  
### Plot over time {.unnumbered}  
### Daily individual tracking  {.unnumbered}  
### Analyse by group {.unnumbered}  
## KPI Tables  
## Transmission Matrices  
## Resources  

<!--chapter:end:new_pages/contact_tracing.Rmd-->


# Survey analysis { }  

Placeholder


## Overview {  }
## Preparation {  }
### Packages {.unnumbered}
### Load data {.unnumbered}
### Clean data {.unnumbered}
## Survey data {  }
## Observation time {  }
## Weighting {  }
## Survey design objects {  }
### **Survey** package  
### **Srvyr** package  
## Descriptive analysis {  }
### Sampling bias 
### Demographic pyramids 
### Alluvial/sankey diagram
## Weighted proportions {  }
### **Survey** package 
### **Srvyr** package 
### **Sitrep** package 
### **Gtsummary** package
## Weighted ratios {  }
### **Survey** package 
### **Srvyr** package 
## Resources {  }

<!--chapter:end:new_pages/survey_analysis.Rmd-->


# Survival analysis { }  

Placeholder


## Overview {}
## Preparation {  }
### Load packages {.unnumbered}  
### Import dataset {.unnumbered}  
### Data management and transformation {.unnumbered}
## Basics of survival analysis {}
### Building a surv-type object {.unnumbered}
### Running initial analyses {.unnumbered}
### Cumulative hazard {.unnumbered}  
### Plotting Kaplan-Meir curves  {.unnumbered}
## Comparison of survival curves 
### Log rank test {.unnumbered}
## Cox regression analysis {}
### Fitting a Cox model {.unnumbered}
### Forest plots {.unnumbered}
## Time-dependent covariates in survival models {}
### Time-dependent covariate setup {.unnumbered} 
#### Add unique patient identifier {.unnumbered}  
#### Expand patient rows {.unnumbered}  
### Cox regression with time-dependent covariates {.unnumbered} 
## Resources {  }

<!--chapter:end:new_pages/survival_analysis.Rmd-->


# GIS basics { }  

Placeholder


## Overview {  }
## Key terms {}  
### GIS software {.unnumbered}
### Spatial data {.unnumbered}
### Visualizing spatial data {.unnumbered}
## Getting started with GIS  
### Types of maps for visualizing your data {.unnumbered}
## Preparation {  }
### Load packages {.unnumbered}  
### Sample case data {.unnumbered}
### Admin boundary shapefiles {.unnumbered}  
### Population data {.unnumbered}  
### Health Facilities {.unnumbered}
## Plotting coordinates {  }
## Spatial joins {}
### Points in polygon {.unnumbered}
### Nearest neighbor {.unnumbered}
### Buffers {.unnumbered} 
### Other spatial joins {.unnumbered}  
## Choropleth maps {}  
## Mapping with ggplot2
## Basemaps { }
### OpenStreetMap {.unnumbered} 
## Contoured density heatmaps {}
### Time series heatmap {.unnumbered}
## Spatial statistics
### Spatial relationships {.unnumbered}  
### Spatial autocorrelation {.unnumbered}  
### Spatial regression {.unnumbered}  
## Resources {  }

<!--chapter:end:new_pages/gis.Rmd-->

# (PART) Data Visualization {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_data_viz.Rmd-->


# Tables for presentation { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered} 
### Import data {.unnumbered}  
### Prepare table {.unnumbered}  
## Basic flextable {  }
### Create a flextable {.unnumbered}  
### Column width {.unnumbered}
### Column headers {.unnumbered}
### Borders and background {.unnumbered}  
### Font and alignment {.unnumbered}
### Merge cells {.unnumbered}  
### Background color {.unnumbered}
## Conditional formatting {  }
## All code together {#tbl_pres_all}  
## Saving your table {  }
### Save single table {.unnumbered}
### Print table in R markdown {.unnumbered}  
## Resources {  }

<!--chapter:end:new_pages/tables_presentation.Rmd-->


# ggplot basics {}

Placeholder


## Preparation {}
### Load packages {.unnumbered}
### Import data {.unnumbered}  
### General cleaning {.unnumbered}
### Pivoting longer {.unnumbered}
## Basics of ggplot {}
## `ggplot()`  
## Geoms  
## Mapping data to the plot {#ggplot_basics_mapping}  
### Plot aesthetics {.unnumbered}  
### Set to a static value {.unnumbered}  
### Scaled to column values {.unnumbered}  
### Where to make mapping assignments {#ggplot_basics_map_loc .unnumbered}
### Groups {#ggplotgroups .unnumbered}  
## Facets / Small-multiples {#ggplot_basics_facet}  
### `facet_wrap()` {.unnumbered}
### `facet_grid()` {.unnumbered}  
### Free or fixed axes {.unnumbered}  
### Factor level order in facets {.unnumbered}  
## Storing plots  
### Saving plots {.unnumbered}
### Modifying saved plots {.unnumbered}  
### Exporting plots {.unnumbered}   
## Labels 
## Themes {#ggplot_basics_themes} 
### Complete themes {.unnumbered}  
### Modify theme {.unnumbered}  
## Colors  
## Piping into **ggplot2**   
## Plot continuous data
### Histograms {.unnumbered}
### Box plots {.unnumbered}
### Violin, jitter, and sina plots {.unnumbered}
### Two continuous variables  {.unnumbered}
### Three continuous variables {.unnumbered}  
## Plot categorical data  
### Preparation  {.unnumbered}
#### Data structure {.unnumbered}  
#### Column class and value ordering {.unnumbered}  
### `geom_bar()` {#ggplot_basics_bars .unnumbered}  
### `geom_col()` {.unnumbered}  
### `geom_histogram()` {.unnumbered}  
## Resources  

<!--chapter:end:new_pages/ggplot_basics.Rmd-->


# ggplot tips {}

Placeholder


## Preparation {}
### Load packages {.unnumbered}
### Import data {.unnumbered}  
## Scales for color, fill, axes, etc. {#ggplot_tips_colors}
### Color schemes
### Scales {#ggplot_tips_scales .unnumbered}  
### Scale arguments {.unnumbered}  
### Manual adjustments {.unnumbered}  
### Continuous axes scales {.unnumbered}  
#### Display percents {.unnumbered}  
#### Log scale {.unnumbered}  
### Gradient scales {.unnumbered}  
### Palettes {.unnumbered}  
#### Colorbrewer and Viridis {.unnumbered}
## Change order of discrete variables {}  
#### **ggthemr** {.unnnumbered}  
## Contour lines  
## Marginal distributions  
## Smart Labeling {}  
## Time axes {}
## Highlighting {}
## Plotting multiple datasets  
## Combine plots {}
### `plot_grid()` {.unnumbered}
### Combine legends {.unnumbered}  
### Inset plots {.unnumbered} 
## Dual axes {}
## Packages to help you  
### Point-and-click **ggplot2** with **equisse**  {.unnumbered}
## Miscellaneous  
### Numeric display {.unnumbered}  
## Resources

<!--chapter:end:new_pages/ggplot_tips.Rmd-->


# Epidemic curves { }  

Placeholder


## Preparation
### Packages {.unnumbered}  
### Import data {.unnumbered}
### Set parameters {.unnumbered}
### Verify dates {.unnumbered}
## Epicurves with **incidence2** package { }
### Simple example {.unnumbered}
### Change time interval of case aggregation {.unnumbered}  
### Groups {.unnumbered}
### Filtered data {.unnumbered}
### Aggregated counts {.unnumbered}
### Facets/small multiples {.unnumbered}  
### Modifications with `plot()` {.unnumbered} 
### Modifications with ggplot2 {.unnumbered}
### Change colors  {.unnumbered}  
#### Specify a palette {.unnumbered}  
#### Specify manually {.unnumbered}  
### Adjust level order {.unnumbered}  
### Vertical gridlines {.unnumbered}  
### Cumulative incidence {.unnumbered}  
### Rolling average  {.unnumbered}
## Epicurves with ggplot2 { }
### Specify case bins {.unnumbered}  
### Weekly epicurve example {.unnumbered}  
#### Sunday weeks {.unnumbered}  
### Group/color by value {.unnumbered}
### Adjust colors {.unnumbered}  
### Adjust level order {.unnumbered}  
### Adjust legend {.unnumbered}
### Bars side-by-side {.unnumbered}  
### Axis limits {.unnumbered}  
### Date-axis labels/gridlines {.unnumbered} 
#### Demonstrations {.unnumbered}
### Aggregated data {.unnumbered} 
#### Plotting daily counts {.unnumbered}  
#### Plotting weekly counts {.unnumbered}
### Moving averages {.unnumbered}
### Faceting/small-multiples {.unnumbered}
#### Total epidemic in facet background {.unnumbered}
#### One facet with data {.unnumbered}  
## Tentative data  
### Using `annotate()` {.unnumbered}
### Bars color {.unnumbered}  
## Multi-level date labels  
## Dual-axis { }  
## Cumulative Incidence {}
## Resources { }

<!--chapter:end:new_pages/epicurves.Rmd-->


# Demographic pyramids and Likert-scales {}  

Placeholder


## Preparation {}
### Load packages {.unnumbered}
### Import data {.unnumbered}  
### Cleaning {.unnumbered}  
## **apyramid** package {}
### Linelist data {.unnumbered}  
#### Missing values {.unnumbered}  
#### Proportions, colors, & aesthetics {.unnumbered}  
### Aggregated data {.unnumbered}  
## `ggplot()` {#demo_pyr_gg}
### Preparation {.unnumbered}
### Constructing the plot {.unnumbered} 
### Compare to baseline  {.unnumbered} 
## Likert scale {}
## Resources {}

<!--chapter:end:new_pages/age_pyramid.Rmd-->


# Heat plots { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
## Transmission matrix  
### Data preparation {.unnumbered}  
#### Make cases data frame {.unnumbered} 
#### Make infectors data frame {.unnumbered}  
### Create heat plot {.unnumbered}  
## Reporting metrics over time { }
### Data preparation {.unnumbered}
#### Aggregate and summarize {.unnumbered}
### Create heat plot {.unnumbered}
### Basic {.unnumbered}  
### Cleaned plot {.unnumbered}
### Ordered y-axis {.unnumbered}  
### Display values {.unnumbered}  
## Resources { }

<!--chapter:end:new_pages/heatmaps.Rmd-->


# Diagrams and charts { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## Flow diagrams { }
### Simple examples {.unnumbered} 
### Syntax  {.unnumbered}
### Complex examples  {.unnumbered}
### Outputs  {.unnumbered}
### Parameterized figures {.unnumbered} 
## Alluvial/Sankey Diagrams { }
### Load packages {.unnumbered}  
### Plotting from dataset {.unnumbered} 
## Event timelines { }
## DAGs { }
## Resources { }

<!--chapter:end:new_pages/diagrams.Rmd-->


# Combinations analysis { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}  
### Re-format values {.unnumbered}  
## **ggupset** {  }
## `UpSetR` {  }
## Resources {  }

<!--chapter:end:new_pages/combination_analysis.Rmd-->


# Transmission chains { }

Placeholder


## Overview {  }
## Preparation {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Creating an epicontacts object {.unnumbered}
## Handling {  }
### Subsetting {.unnumbered}
### Accessing IDs {.unnumbered}
## Visualization {  }
### Basic plotting {.unnumbered}
#### Visualising node attributes {.unnumbered}
#### Visualising edge attributes {.unnumbered}
### Temporal axis {.unnumbered}
#### Specifying transmission tree shape {.unnumbered}
#### Saving plots and figures {.unnumbered}
### Timelines {.unnumbered}
## Analysis {  }
### Summarising {.unnumbered}
### Pairwise characteristics {.unnumbered}
### Identifying clusters {.unnumbered}
### Calculating degrees {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/transmission_chains.Rmd-->


# Phylogenetic trees {}  

Placeholder


## Overview {}
## Preparation {}
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
### Clean and inspect {.unnumbered}  
## Simple tree visualization {}
### Different tree layouts {.unnumbered}  
### Simple tree plus sample data {.unnumbered}  
## Tree manipulation {}
### Zoom in {.unnumbered}  
### Collapsing branches {.unnumbered} 
### Subsetting a tree {.unnumbered} 
### Rotating nodes in a tree {.unnumbered} 
### Example subtree with sample data annotation {.unnumbered} 
## More complex trees: adding heatmaps of sample data {.unnumbered}
## Resources {}

<!--chapter:end:new_pages/phylogenetic_trees.Rmd-->


# Interactive plots { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}  
### Start with a `ggplot()` {.unnumbered}  
### Import data {.unnumbered}
## Plot with `ggplotly()` {  }
## Modifications {  }
### File size {.unnumbered}  
### Buttons {.unnumbered}  
## Heat tiles {  }
## Resources {  }

<!--chapter:end:new_pages/interactive_plots.Rmd-->

# (PART) Reports and dashboards {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_reports_dashboards.Rmd-->


# Reports with R Markdown { }  

Placeholder


## Preparation {  }
## Getting started {  }
### Install rmarkdown R package {.unnumbered}
### Starting a new Rmd file {.unnumbered}
### Important to know {.unnumbered}
## R Markdown components {  }
### YAML metadata {.unnumbered}
### Text {.unnumbered}
#### New lines {.unnumbered}  
#### Case {.unnumbered}  
#### Color {.unnumbered}  
#### Titles and headings {.unnumbered}  
#### Bullets and numbering {.unnumbered}  
#### Comment out text {.unnumbered}
### Code chunks {.unnumbered}
#### In-text R code {.unnumbered}  
### Images {.unnumbered}  
### Tables {.unnumbered}  
### Tabbed sections {.unnumbered}  
## File structure {}
### Self-contained Rmd {.unnumbered}  
#### Source other files {.unnumbered}
### Runfile {.unnumbered}  
### Folder strucutre {.unnumbered}  
## Producing the document  
### Option 1: "Knit" button {.unnumbered}  
### Option 2: `render()` command {.unnumbered}
###  Options 3: **reportfactory**  package {.unnumbered}  
## Parameterised reports {  }
### Setting parameters {.unnumbered}
#### Option 1: Set parameters within YAML {.unnumbered}
#### Option 2: Set parameters within `render()` {.unnumbered}  
#### Option 3: Set parameters using a Graphical User Interface {.unnumbered}  
### Parameterized example {.unnumbered} 
### Parameterisation without `params` {.unnumbered}
## Looping reports  {  }
## Templates  
### Word documents {.unnumbered}
### Powerpoint documents {.unnumbered}
### Integrating templates into the YAML {.unnumbered}
### Formatting HTML files {.unnumbered}
## Dynamic content  
### Tables {.unnumbered}  
### HTML widgets {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/rmarkdown.Rmd-->


# Organizing routine reports {  }  

Placeholder


## Preparation
### Load packages {.unnumbered}  
## New factory  
## Create a report  
## Compile  
### Compile by name {.unnumbered}  
### Compile by number {.unnumbered}
### Compile all {.unnumbered}
### Compile from sub-folder {.unnumbered}  
### Parameterization {.unnumbered}
### Using a "run-file" {.unnumbered}  
## Outputs  
## Miscellaneous  
### Knit {.unnumbered} 
### Scripts {.unnumbered}  
### Extras {.unnumbered} 
## Resources {  }

<!--chapter:end:new_pages/reportfactory.Rmd-->


# Dashboards with R Markdown { }

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## Create new R Markdown  
## The script  
### YAML {.unnumbered}  
### Code chunks {.unnumbered}  
### Narrative text {.unnumbered}  
### Headings {.unnumbered}  
## Section attributes  
## Layout {#layout}  
### Pages {.unnumbered}  
### Orientation {.unnumbered}  
### Tabs {.unnumbered} 
## Adding content  
### Text {.unnumbered}  
### Tables {.unnumbered}  
### Plots {.unnumbered}  
### Interactive plots {.unnumbered}  
### HTML widgets {.unnumbered}
## Code organization
## Shiny  
### Settings {.unnumbered}  
### Worked example {.unnumbered}  
### Other examples {.unnumbered}  
## Sharing  
## Resources  

<!--chapter:end:new_pages/flexdashboard.Rmd-->


# Dashboards with Shiny { }  

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## The structure of a shiny app {  }
### Basic file structures {.unnumbered}  
### The server and the ui {.unnumbered}
### Before you start to build an app {.unnumbered}
## Building a UI 
## Loading data into our app
## Developing an app server
## Adding more functionality
### Adding static text {.unnumbered}  
### Adding a link {.unnumbered}
### Adding a download button {.unnumbered}
### Adding a facility selector {.unnumbered}  
### Adding another tab with a table {.unnumbered}
## Sharing shiny apps
## Further reading
## Recommended extension packages
## Recommended resources

<!--chapter:end:new_pages/shiny_basics.Rmd-->

# (PART) Miscellaneous {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
# library(knitr)
# opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_misc.Rmd-->


# Writing functions  

Placeholder


## Preparation {  }
### Load packages {-}
### Import data {-}
## Functions  
## Why would you use a function? 
## How does R  build functions?
## Basic syntax and structure
## Examples  
### Return proportion tables for several columns {.unnumbered}  
## Using **purrr**: writing functions that can be iteratively applied
### Modify class of multiple columns in a dataset {.unnumbered}  
### Iteratively produce graphs for different levels of a variable {.unnumbered}
### Iteratively produce tables for different levels of a variable {.unnumbered}
## Tips and best Practices for well functioning functions
### Naming and syntax {.unnumbered}
### Column names and tidy evaluation {.unnumbered}  
### Testing and Error handling {.unnumbered}
## Resources

<!--chapter:end:new_pages/writing_functions.Rmd-->


# Directory interactions { }  

Placeholder


## Preparation  
### **fs** package {.unnumbered}  
### Print directory as a dendrogram tree {.unnumbered}  
## List files in a directory  
## File information  
## Check if exists  
### R objects {.unnumbered}  
### Directories {.unnumbered}  
### Files {.unnumbered}  
## Create  
### Directories {.unnumbered}  
### Files {.unnumbered}  
### Create if does not exists {.unnumbered}  
## Delete
### R objects {.unnumbered}  
### Directories {.unnumbered}  
### Files {.unnumbered}  
## Running other files  
### `source()` {.unnumbered}  
### `render()` {.unnumbered}  
### Run files in a directory {.unnumbered}
### Import files in a directory  {.unnumbered}
## **base** R  
## Resources {  }

<!--chapter:end:new_pages/directories.Rmd-->


# Version control and collaboration with Git and Github

Placeholder


## What is Git?
## Why use the combo Git and Github?
### This sounds complicated, I am not a programmer {-}
## Setup
### Install Git {.unnumbered}
### Install an interface (optional but recommended) {.unnumbered}
### Github account {.unnumbered}
## Vocabulary, concepts and basic functions
### Repository {.unnumbered}
### Commits {.unnumbered}
### Branches {.unnumbered}
### Local and remote repositories {.unnumbered}
## Get started: create a new repository
### Start-up files {.unnumbered}
### Create a new repository in Github {.unnumbered}
### Clone from a Github repository {.unnumbered}
#### In Rstudio {.unnumbered}
#### In Github Desktop {.unnumbered}
### New Github repo from existing R project {.unnumbered}
### What does it look like now? {.unnumbered}
#### In RStudio {-}
#### In Github Desktop {-}
## Git + Github workflow
### Process overview {.unnumbered}
## Create a new branch
### In Rstudio Git pane {.unnumbered}
### In Github Desktop {.unnumbered}
### In console {.unnumbered}
## Commit changes
### In Rstudio {.unnumbered}
### In Github Desktop {.unnumbered}
### In console {.unnumbered}
### Amend a previous commit {.unnumbered}
## Pull and push changes up to Github
#### In Rstudio {.unnumbered}
#### In Github Desktop {.unnumbered}
#### Console {.unnumbered}
### I want to pull but I have local work {.unnumbered}
## Merge branch into Main 
### Locally in Github Desktop {.unnumbered}
### In console {.unnumbered}
### In Github: submitting pull requests {.unnumbered}
### Resolving conflicts {.unnumbered}
### Delete your branch {.unnumbered}
#### Github + Rstudio
#### In Github Desktop
### Forking {.unnumbered}
## What we learned
## Git commands {#git}
### Recommended learning {.unnumbered}
### Where to enter commands {.unnumbered}
### Sample commands {.unnumbered}
## Resources

<!--chapter:end:new_pages/collaboration.Rmd-->


# Common errors  

Placeholder


## Interpreting error messages  
## Common errors  
### Typo errors {.unnumbered}  
### Package errors {.unnumbered}  
### Object errors {.unnumbered}  
### Function syntax errors {.unnumbered}
### Logic errors {.unnumbered}  
### Factor errors {.unnumbered}  
### Plotting errors {.unnumbered}  
### R Markdown errors {.unnumbered}  
### Miscellaneous {.unnumbered}  
## Resources { }

<!--chapter:end:new_pages/errors.Rmd-->


# Getting help  

Placeholder


## Github issues  
## Reproducible example  
### The **reprex** package {.unnumbered}  
### Minimal data {.unnumbered}  
## Posting to a forum  
## Resources { }

<!--chapter:end:new_pages/help.Rmd-->


# R on network drives { }  

Placeholder


## Overview {  }
## RStudio as administrator  
## Useful commands 
## Troubleshooting common errors {  }

<!--chapter:end:new_pages/network_drives.Rmd-->


# Data Table { }  

Placeholder


## Intro to data tables {  }
## Load packages and import data { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
## The i argument: selecting and filtering rows{ }
### Using helper functions for filtering {.unnumbered}  
## The j argument: selecting and computing on columns{ }
### Selecting columns {.unnumbered} 
### Computing on columns {.unnumbered} 
## The by argument: computing by groups{ }
## Adding and updating to data tables { }
## Resources {  }

<!--chapter:end:new_pages/data_table.Rmd-->

